---
layout: post
categories: [Hive]
description: none
keywords: Hive
---
# 数据仓库框架Hive
Hive是一个构建在Hadoop上的数据仓库框架，是应Facebook每天产生的海量网络数据进行管理和（机器）学习的需求而产生和发展的。

## 什么是Hive
Hive本身是数据仓库。那么什么又是数据仓库呢？首先先来了解一下数据仓库的概念及数据仓库的特点。

数据仓库是为了协助分析报告，支持决策，为需要业务智能的企业提供业务流程的改进和指导，从而节省时间和成本，提高质量。它与数据库系统的区别是，数据库系统可以很好地解决事务处理，实现对数据的“增、删、改、查”操作，而数据仓库则是用来做查询分析的数据库，通常不会用来做单条数据的插入、修改和删除。
Hive作为一个数据仓库工具，非常适合数据的统计分析，它可以将数据文件组成表格并具有完整的类SQL查询功能，还可将类SQL语句自动转换成MapReduce任务来运行。因此，如果使用Hive，可以大幅提高开发效率。
和传统的数据仓库一样，Hive主要用来访问和管理数据。与传统数据仓库较大的区别是，Hive可以处理超大规模的数据，可扩展性和容错性非常强。由于Hive有类SQL的查询语言，所以学习成本相对比较低。

## Hive和数据库的异同
很多初学者会将Hive与关系型数据库混淆，认为Hive就是关系型数据库，主要原因是由于Hive采用了类SQL的查询语言HQL（Hive Query Language）所致。其实，HQL的引入仅仅是为了降低学习成本，底层还是MapReduce。Hive本身是数据仓库，并不是数据库系统，清楚这一点，有助于理解Hive的特性。

## Hive的执行流程
在Hive上执行查询时，整体流程大致步骤如下：
- 用户提交查询任务到Driver。
- 编译器Compiler获得用户的任务计划。
- 编译器Compiler根据用户任务从Metastore中得到所需的Hive元数据信息。
- 编译器Compiler对任务进行编译，首先将HQL转换为抽象语法树，接着把抽象语法树转换成查询语句块，并将查询语句块转化为逻辑的查询计划。
- 把最终的计划提交到Driver。
- Driver将计划提交到Execution Engine，获得元数据信息，接着提交到JobTracker或者Source Manager运行该任务，该任务会直接从HDFS中读取文件并进行相应的操作。
- 取得并返回执行结果。

## 元数据存储Metastore
Metastore是Hive集中存放元数据的地方。Metastore包括两部分：服务和后台数据的存储。Hive有3种Metastore的配置方式，分别是内嵌模式、本地模式和远程模式。

内嵌模式使用的是内嵌的Derby数据库来存储数据，配置简单，但是一次只能与一个客户端连接，适用于做单元测试，不适用于生产环境。

本地模式和远程模式都采用外部数据库来存储数据，目前支持的数据库有MySQL、Oracle、SQL Server等，在这里我们使用MySQL数据库。本地元存储和远程元存储的区别是本地元数据不需要单独启动Metastore服务，因为本地元存储用的是和本地Hive在同一个进程里的Metastore服务。

在默认的情况下，Metastore服务和Hive服务运行在同一个虚拟机中，它包含一个内嵌的以本地磁盘作为存储的Derby数据库实例，被称之为“内嵌Metastore配置”。

