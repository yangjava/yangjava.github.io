---
layout: post
categories: [Python]
description: none
keywords: Python
---
# 数仓建设

## 数据仓库概念
数据仓库之父比尔·恩门（Bill Inmon）在1991年出版的“Building the Data Warehouse”（《建立数据仓库》）一书中所提出的：数据仓库（Data Warehouse）是一个面向主题的（Subject Oriented）、集成的（Integrated）、相对稳定的（Non-Volatile）、反映历史变化（Time Variant）的数据集合，用于支持管理决策(Decision Making Support)。
数据仓库特点：
- 面向主题的，操作型数据库的数据组织面向事务处理任务，而数据仓库中的数据是按照一定的主题域进行组织。主题是指用户使用数据仓库进行决策时所关心的重点方面，一个主题通常与多个操作型信息系统相关。
- 集成的，数据仓库的数据有来自于分散的操作型数据，将所需数据从原来的数据中抽取出来，进行加工与集成，统一与综合之后才能进入数据仓库。
- 相对稳定的，数据仓库主要是为决策分析提供数据，所涉及的操作主要是数据的查询，基本数据不更新。
- 随时间而变化的，传统的关系数据库系统比较适合处理格式化的数据，能够较好的满足商业商务处理的需求。稳定的数据以只读格式保存，且不随时间改变。

## 数仓分层理论
DW, data warehouse,数据仓库，也称为数仓。数仓，就是存储数据的一个仓库。
- 数据运营层 ：ODS, Operational Data Store
- 数据仓库层 ：DW, Data Warehouse，包含DWD,DWB,DWS
- 数据服务层 ：ADS, Application Data Service

### ODS
数据贴源层：ODS, Operational Data Store。
原始数据层，存放未经处理的原始数据，结构上与数据源保持一致，是数仓的数据准备区，数据原则上全量保留。存放原始数据，直接加载原始日志等数据

### DW
数据仓库层，一般分为数仓明细层（DWD），数仓汇总层(DWS)。
DWD层以业务过程作为建模驱动，基于具体业务特点，构建最细粒度的明细层事实表，数据粒度一般保持与ODS一样，主要进行标准化清洗处理。
DWS层以分析的主题对象作为建模驱动，基于上层应用，构建公共维度的汇总指标事实表，构建命名规范，口径一致的统计指标。

#### DWD
- 数据明细层：DWD, Data Warehouse Detail。
- 结构和力度与ODS保持一致，对ODS层数据进行清洗（如去除空值、去除脏数据等），在该层中有ETL（extract transform load, 提取转换加载处理），存储维度表、事实表、实体表等数据。
- 在DWD中，一般会做数据映射，如将时间转为年月日等维度信息，将手机号码转为省市区运营商类型等。
- DWD是业务层与数据仓库之间的隔离层。

#### DWB
- 数据基础层、数据中间层：DWB，Data Warehouse Base。
- 存储客观数据，一般用作中间层，存有大量指标。

#### DWS
- 数据服务层、数据汇总层、数据聚合层：DWS, Data Warehouse Service。 
- 在DWM基础上，整合汇总成一个主题的数据服务层，一般是宽表。
- 使用主题建模、维度建模等方式建模。

### ADS
数据应用层、数据结果层：ADS, Application Data Service。
面向业务需求，直接提供给业务人员使用。以DWD或DWS的数据为基础，组成各类统计报表。
一般都是结果类型数据，可直接使用或展示，存放在Es、Redis、PostgreSql等系统中，面向数据分析和挖掘使用，主要存放数据产品个性化的一些统计指标数据，如经过数据公共层CDM和数据贴源层ODS加工生成的数据报表等。
属于最顶层，一般直接对接OLAP分析或业务层数据调用接口，由也无需求决定数据维度和结果分析。

## 优点
- 明确数据分层结构 ：使用分层机制，每层权责分明，使用表时便于定位排查，便于血缘追踪。同时，通过分层，将复杂任务拆解多个步骤处理，便于维护数据准确性。
- 减少重复开发 ：逐步处理，最上层ADS需要数据时，可以复用中间层级的处理后的数据，无需从最下一层提取，提升数据处理速度。
- 屏蔽原始数据的异常 ：更上一层的数据都是从下一层或者下多层处理而来，下层数据丢失，上层数据还存在（数据冗余机制），对于整体数据而言不会对应用产生灾难性影响，

## 数仓模型
表类型
- 维度表 ：存储的维度信息，数据量不会很大。
- 事实表 ：存储一些事实信息 ，如订单、购物车等信息，数据量较大。
- 实体表 ：存储描述信息，如商品优惠券表等，数据量主要看变化程度。

建模类型
- 主题建模 ：围绕某个业务主体进行数据建模，将相关数据抽离提取出来。
- 维度建模 ：根据业务需要，提前将后续数据查询处理需要的维度数据抽离出来，便于后续查询使用。

### 星型模型
星形模式(Star Schema)是最常用的维度建模方式。星型模式是以事实表为中心，所有的维度表直接连接在事实表上。
星型模型具有以下特点：
- 维表只和事实表关联，维表之间没有关联；
- 每个维表主键为单列，且该主键放置在事实表中，作为两边连接的外键；
- 以事实表为核心，维表围绕核心呈星形分布；

### 雪花模型
雪花模式(Snowflake Schema)是对星形模式的扩展。雪花模式的维度表可以拥有其他维度表的，虽然这种模型相比星型更规范一些，但是由于这种模型不太容易理解，维护成本比较高，而且性能方面需要关联多层维表，性能也比星型模型要低。所以一般不是很常用。

### 星座模式
星座模式是星型模式延伸而来，星型模式是基于一张事实表的，而星座模式是基于多张事实表的，而且共享维度信息。

前面介绍的两种维度建模方法都是多维表对应单事实表，但在很多时候维度空间内的事实表不止一个，而一个维表也可能被多个事实表用到。

在业务发展后期，绝大部分维度建模都采用的是星座模式。


