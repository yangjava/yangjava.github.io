---
layout: post
categories: [Mongodb]
description: none
keywords: MongoDB
---
# MongoDB效率工具


## SQL转MongoDB语法工具类
最近写了一个目录管理的需求，用的MySQL数据库，存储了一些查询条件，对接我的同事他做的模块用的是MongoDB数据库,这样就需要转义。
```text
a != 1 and b = 2 or (c =3 and d = 4 or e like '%5%')
```
Github工具包地址[https://github.com/vincentrussell/sql-to-mongo-db-query-converter](https://github.com/vincentrussell/sql-to-mongo-db-query-converter)

### 引用依赖
```xml
<dependency>
   <groupId>com.github.vincentrussell</groupId>
   <artifactId>sql-to-mongo-db-query-converter</artifactId>
   <version>1.21</version>
</dependency>
```
### 封装转义工具类
```java
import com.github.vincentrussell.query.mongodb.sql.converter.MongoDBQueryHolder;
import com.github.vincentrussell.query.mongodb.sql.converter.QueryConverter;
import lombok.extern.slf4j.Slf4j;
import org.bson.Document;
 
/**
 * 类描述: mysql语句转mongoDB语句
 *
 */
@Slf4j
public class MysqlConvertToMongoDB {
 
    public static Document SqlConvertToMongoDB(String dataCondition) throws Exception {
        log.info("需要转义sql： " + dataCondition);
        String sql = "select * from t where " + dataCondition;
        log.info("转义前的sql： " + sql);
        QueryConverter queryConverter = new QueryConverter.Builder().sqlString(sql).build();
        MongoDBQueryHolder mongoDBQueryHolder = queryConverter.getMongoQuery();
        String collection = mongoDBQueryHolder.getCollection();
        Document query = mongoDBQueryHolder.getQuery();
        String mongosql = query.toJson();
        log.info("转义后的sql： " + mongosql);
        log.info("返回值Document： " + query);
        return query;
    }
 
}
```

### 测试用例
```java
import org.bson.Document;
 
/**
 * 类描述:
 *
 */
public class CheckFormat {
    public static void main(String[] args) throws Exception {
 
        Document document = MysqlConvertToMongoDB.SqlConvertToMongoDB("a != 1 and b = 2 or (c =3 and d = 4 or e like '%5%')");
 
    }
 
}
```
