---
layout: post
categories: [Mongodb]
description: none
keywords: Mongodb
---
# MongoDB简介
MongoDB 是免费开源的跨平台 NoSQL 数据库，命名源于英文单词 humongous，意思是「巨大无比」，可见开发组对 MongoDB 的定位。

## 简介
MongoDB是一种流行的NoSQL数据库，它使用文档数据模型来存储数据。相比关系型数据库，MongoDB更加灵活，具有更好的可扩展性和性能。它支持水平扩展，可以在多个服务器之间分布数据，从而实现更高的可用性和性能。

MongoDB基于NoSQL文档存储模型；在这种模型中，数据对象被存储为集合中的文档，而不是传统关系型数据库中的行和列。文档是以二进制JSON（BSON）对象的方式存储的。

MongoDB 是由C++语言编写的，是一个基于分布式文件存储的开源数据库系统。 MongoDB旨在实现一种高性能、高可用、可自动扩展的数据存储，它安装和实现起来都非常简单。

MongoDB因为速度快、可扩展性强、易于实现，为需要存储用户评论、博客和其他内容的网站提供了极佳的后端存储解决方案。

## 主要特点
下面是MongoDB得以成为最受欢迎的NoSQL数据库的其他一些原因。
- 面向文档： MongoDB是面向文档的，数据在数据库中的存储格式与您要在服务器端脚本和客户端脚本中处理的格式非常接近。这避免了将数据在行和对象之间进行转换。
- 高性能： MongoDB是市面上性能最高的数据库之一。在当今世界，很多用户都与网站交互，因此拥有能够支持庞大流量的后端至关重要。
- 高可用性： MongoDB的复制模型使其很容易保持高可用性，同时能够提供高性能和高可扩展性。
- 高可扩展性： MongoDB的结构使得能够将数据分布到多台服务器，从而轻松地实现横向扩展。
- 对SQL注入攻击免疫： MongoDB将数据存储为对象，而不使用SQL字符串，因此对SQL注入攻击（通过浏览器在Web表单中输入SQL语句，从而威胁DB的安全）免疫。
- MongoDB支持各种编程语言:RUBY，PYTHON，JAVA，C++，PHP，C#等多种语言。

## MongoDB的作用
存储半结构化数据：MongoDB使用文档数据模型来存储数据，这使得它非常适合存储半结构化数据，例如JSON文档。这种数据模型非常灵活，可以轻松地进行嵌套和复杂查询

支持各种数据类型：MongoDB支持各种数据类型，包括数字、日期、字符串、数组和嵌入式文档等。这使得它非常适合存储不同类型的数据

提供高级功能：MongoDB提供了许多高级功能，例如全文搜索、地理空间索引和图形搜索等。它还有一个强大的聚合框架，可以用于数据聚合和分析

适用于各种应用程序：MongoDB的文档模型和可扩展性使其成为许多应用程序的理想选择，例如Web应用程序、移动应用程序和物联网设备。它可以用于各种不同类型的应用程序，从简单的博客到复杂的企业级应用程序

## MongoDB概念
不管我们学习什么数据库都应该学习其中的基础概念，在mongodb中基本的概念是文档、集合、数据库，下面我们挨个介绍。

下表将帮助您更容易理解Mongo中的一些概念：

| SQL术语/概念     | MongoDB术语/概念       | 解释/说明                   |
|--------------|--------------------|-------------------------|
| database     | database           | 数据库                     |
| table        | collection         | 数据库表/集合                 |
| row          | document           | 数据记录行/文档                |
| column       | field              | 	数据字段/域                 |
| index        | index              | 索引                      |
| table joins  |                    | 表连接,MongoDB不支持          |
| primary key  | primary key	       | 主键，MongoDB自动将_id字段设置为主键 |

### 理解集合
MongoDB使用集合将数据编组。集合是一组用途相同或类似的文档，相当于传统SQL数据库中的表，但存在一个重要差别：在MongoDB中，集合不受严格模式的管制，其中的文档可根据需要采用稍微不同的结构。这样就无需将文档的内容放在多个不同的表中，而在SQL数据库中经常需要这样做。

### 理解文档
在MongoDB数据库中，文档表示单个实体的数据，而集合包含一个或多个相关的文档。MongoDB和SQL的一个主要差别在于文档不同于行：行数据是扁平的，每列都包含行中的一个值，而在MongoDB中，文档可包含嵌入的子文档，提供的数据模型与应用程序的要求更一致。

事实上，MongoDB中表示文档的记录是以BSON（一种轻量级二进制JSON）的方式存储的。BSON是一种轻量级二进制JSON，使用对应于JavaScript属性/值对的字段/值对来定义文档中存储的值。几乎不需要做任何转换，就能将MongoDB记录转换为您可能在应用程序中使用的JSON字符串。

例如，MongoDB中文档的结构可能类似于下面这样，其中包含字段name、version、languages、admin和paths：
```
{
    name: "New Project",
    version: 1,
    languages: ["JavaScript", "HTML", "CSS"],
    admin: {name: "Brad", password: "****"},
    paths: {temp: "/tmp", project:"/opt/project", html: "/opt/project/html"}
}
```
注意到在这个文档结构中，包含类型为字符串、整数、数组和对象的字段/属性，就像JavaScript对象一样。

字段名不能包含空格、句点（.）和美元符号（$）。另外，字段名_id保留用于存储对象ID（Object ID）。字段_id包含系统中独一无二的ID，这种ID由下列几部分组成：
- 从新纪元开始的秒数（4字节）。
- 3字节的机器标识符。
- 2字节的进程ID。
- 3字节的计数器（该计数器的起始值是随机的）。
MongoDB文档最大不能超过16MB，这旨在避免查询占用太多RAM或频繁访问文件系统。文档也许根本不会接近这样的规模，但设计包含文件数据的复杂类型时必须牢记这种最大文档限制。

## mongodb的架构
mongodb在企业中通常使用副本集集群或者分片集群架构
- 副本集：MongoDB副本集是MongoDB的高可用性机制之一，它通过在多个服务器上复制数据来提高可用性

### 副本集角色讲解
主节点（Primary）：主节点是副本集中的主要节点，它负责所有写入操作，并将写入操作记录到Oplog中。主节点还负责管理副本集的元数据信息，例如副本集的成员列表和状态信息

从节点（Secondary）：从节点是副本集中的备份节点，它们负责复制主节点上的数据，并提供读取操作。从节点会异步地复制Oplog中的数据，并将其应用到本地副本中。从节点还可以被用作查询节点，以减轻主节点的负载，搭建好后需要配置从节点才能在从节点上实现读取，否则从节点是不提供读写功能的，一般在开发使用mongodb的时候通过连接命令配置

仲裁节点（Arbiter）：仲裁节点是一个特殊的节点，它不存储数据，只用于投票选举主节点。仲裁节点通常被用于小型副本集中，以减少节点数量和成本

### 副本集组件
Oplog（操作日志）：Oplog是MongoDB副本集中的一个特殊集合，它记录了所有写入操作。主节点将写入操作记录到Oplog中，并将Oplog中的数据发送到从节点。从节点会异步地复制Oplog中的数据，并将其应用到本地副本中

配置文件（Config File）：配置文件是MongoDB副本集的一个配置文件，它存储了副本集的元数据信息，例如成员列表和状态信息。配置文件通常存储在一个独立的配置服务器上

### 副本集作用
主节点选举：当主节点发生故障或不可用时，副本集会自动选举一个新的主节点。选举过程基于多数投票原则，只有获得大多数节点的投票才能成为新的主节点

数据复制：MongoDB副本集使用异步复制来复制数据。主节点将写入操作记录到Oplog（操作日志）中，并将Oplog中的数据发送到从节点。从节点会异步地复制Oplog中的数据，并将其应用到本地副本中

读取操作：当客户端执行读取操作时，路由器会将请求路由到主节点或从节点。如果请求是只读操作，则通常会将其路由到一个从节点上，以减轻主节点的负载

写入操作：当客户端执行写入操作时，路由器会将请求路由到主节点上。主节点将写入操作记录到Oplog中，并将其发送到所有从节点上。从节点异步地复制Oplog中的数据，并将其应用到本地副本中

故障转移：当主节点发生故障或不可用时，副本集会自动选举一个新的主节点。选举过程基于多数投票原则，只有获得大多数节点的投票才能成为新的主节点

MongoDB副本集提供了高可用性和数据冗余功能，可以帮助应用程序保持可用性并保护数据免受故障和灾难的影响

注意在MongoDB副本集中，主节点和备节点的数据在任意时间并不总是完全一致。虽然MongoDB副本集旨在确保数据在主节点和备节点之间的复制是准确和可靠的，但是在某些情况下，主节点和备节点之间可能会存在数据延迟，当主节点收到写操作时，它会将操作应用于本地副本，并将操作异步地传输到副本集中的其他节点。这意味着，如果您在主节点上执行写操作，数据将首先被写入主节点，然后异步地传输到备节点。因此，在某些情况下，备节点上的数据可能会略微滞后于主节点上的数据

分片集群：MongoDB的横向扩展机制，它可以将数据分布到多个服务器上，从而实现更高的可用性和性能。MongoDB分片集群由多个分片组成，每个分片都是一个独立的MongoDB实例，它可以在不同的服务器上运行，一般在生产中会使用分片+副本集的组合实现分片集群的高可用和横向扩展功能，如果单单使用分片集群的话，某节点挂掉时，MongoDB会自动将数据迁移到其他分片上

### 分片集群特点和工作原理
分片键：MongoDB使用分片键来将数据分布到多个分片上。分片键是一个用于划分数据的字段或字段组合。MongoDB会根据分片键的值将数据分配到不同的分片上

路由器：路由器是MongoDB的组件之一，它负责接收客户端请求，并将请求路由到正确的MongoDB分片上。路由器还负责维护分片键和分片元数据信息

配置服务器：配置服务器是MongoDB的组件之一，它存储了MongoDB分片集群的元数据信息，例如分片键和分片元数据信息。配置服务器通常由多个副本组成，以提高可用性和容错性

分片元数据：MongoDB使用分片元数据来跟踪数据在分片集群中的位置。分片元数据包括每个分片的状态、分片键范围和分片版本等信息。配置服务器负责维护分片元数据信息

数据迁移：当需要添加或删除分片时，MongoDB会自动进行数据迁移。数据迁移是将数据从一个分片移动到另一个分片的过程。MongoDB会自动将数据分配到新的分片上，并将数据从旧的分片上删除

故障转移：当一个分片发生故障或不可用时，MongoDB会自动将数据迁移到其他分片上。这个过程是自动的，无需人工干预

### 分片集群组件
分片（Shard）：每个分片是一个MongoDB实例，用于存储部分数据集。分片可以在同一台机器上或分布在多台机器上运行，可以根据需要添加或删除

路由器（Router）：路由器是一个mongos进程，作为客户端与分片集群之间的接口。它将客户端请求路由到适当的分片，并将分片的响应汇总并返回给客户端

配置服务器（Config Server）：配置服务器是一个MongoDB实例，用于存储分片集群的元数据（如分片信息和数据位置）。通常情况下，配置服务器有三个副本，以提供高可用性和数据冗余

客户端（Client）：客户端是使用MongoDB分片集群的应用程序或工具。客户端通过路由器与分片集群进行交互，并使用MongoDB查询语言来操作数据

### 分片集群角色

分片节点（Shard Node）：每个分片节点是一个MongoDB实例，用于存储部分数据集。分片节点可以是主节点或从节点

配置节点（Config Node）：配置节点是一个MongoDB实例，用于存储分片集群的元数据。配置节点通常是主节点，但也可以是从节点

MongoDB副本集提供了高可用性、高性能、横向扩展能力

## 参考资料
mongodb官网：[https://www.mongodb.com/](https://www.mongodb.com/)

mongodb中文文档：[https://www.mongodb.org.cn/](https://www.mongodb.org.cn/)
	


