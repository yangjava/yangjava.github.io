---
layout: post
categories: [Java]
description: none
keywords: Java
---
# Java输入输出
java.io和java.nio包中的很多类为基本I/O提供了大量工具，Java即在此基础上构建实现了所有的文件和网络通信。

## 流
Java中大多数基本I/O都建立在流基础上。流（stream）表示一个数据流，或者是一个通信通道，其一端为一个写者（writer），而另一端为一个读者（reader），至少从概念来讲可以如此理解。在Java中，当使用java.io包完成终端输入和输出、读写文件或通过套接字通信时，所使用的正是各种类型的流。

## Java中的流
- InputStream, OutputStream
为读写非结构化字节序列定义基本功能的抽象类。Java中所有其他字节流都建立在基本的InputStream和OutputStream之上。
- Reader, Writer
为读写字符数据序列定义基本功能的抽象类，并提供了对Unicode的支持。Java中所有其他字符流都建立在Reader和Writer之上。
- InputStreamReader, OutputStreamWriter
此为“桥”类，可以将字节转换为字符，以及将字符转换为字节。要记住，对于Unicode，字符并非一个字节！
- DataInputStream, DataOutputStream
特定的流过滤器，其中增加了以一种统一格式读写简单数据类型的功能，如数字基本类型和String对象。
- ObjectInputStream, ObjectOutputStream
特定的流过滤器，具备写整组的序列化的Java对象以及重新构造它们的功能。
- BufferedInputStream/BufferedOutputStream/BufferedReader/BufferedWriter
特定的流过滤器，为提高效率增加了缓冲机制。
- PrintStream, PrintWriter
一个特定的字符流，可以很容易地打印文本。
- PipedInputStream, PipedOutputStream, PipedReader, PipedWriter
通常成对出现的“双端”流。写入一个PipedOutputStream或PipedWriter的数据要从其相应的PipedInputStream或PipedReader读取。
- FileInputStream, FileOutputStream, FileReader, FileWriter
- InputStream、OutputStream、Reader和Writer的实现，可对本地文件系统进行读写。
Java中的流都是“单行道”。java.io输入和输出类分别表示了一个简单流的两端。要进行双向通信，就需要同时使用这两种类型的流。

InputStream和OutputStream是为所有字节流定义底层接口的抽象类。其中包含了读或写一个非结构化字节级数据流的方法。由于这两个类是抽象的，因此不能创建一个通用的输入或输出流。Java实现了这些类的子类，可用于完成对文件读写以及与套接字通信等活动。由于所有字节流都继承了InputStream或OutputStream的结构，因此各种类型的字节流可以交互地加以使用。如果某个方法指定要以一个InputStream作为参数，那么它当然也可以接受InputStream的任何子类。还可以分层提供特定类型的流，从而提供诸如缓冲、过滤或处理更大数据类型等特性。

Reader和Writer与InputStream和OutputStream非常相似，只有一点有所不同，即前者处理的是字符而不是字节。作为真正的字符流，这些类可以正确地处理Unicode字符，而字节流对此则不能保证。通常情况下，在这些字符流和物理设备（如磁盘和网络）的字节流之间需要桥梁。InputStreamReader和OutputStreamWriter就是使用一种编码机制从而将字符流和字节流相互转换的特殊类。

## 字节流与字符流
流（stream）是一组有序的数据序列。根据操作的类型，分为输入流和输出流两种。在程序中，所有的数据流都是以流的方式进行传输和保存的。程序需要数据时，就使用输入流读取数据，程序需要将一些数据保存起来时，就使用输出流。

流的操作主要有字节流和字符流两大类，两类都有输入和输出操作。在字节流中输入数据使用的是InputStream类，输出数据使用的是OutputStream类。在字符流中输入数据使用是Reader类，输出数据使用是Writer类。

### 字节流
字节流主要操作byte类型数据。以byte数组为准，主要操作类是InputStream和OutputStream。

#### 字节输出流：OutputStream类
OutputStream类是一个抽象类，如果使用此类，就必须通过子类实例化对象。如果要操作的对象是一个文件，就可以使用FileOutputStream类，通过向上转型实现实例化。下面的示例演示了向文件中写入字符串。

```java
import java.io.File;
import java.io.FileOutputStream;
import java.io.OutputStream;
public class OutputStreamDemo {
     public static void main(String[] args) throws Exception{
          // 找到一个文件
          File f = new File("d:" + File.separator + "kj.txt");
          // 实例化--子类实例化父类
          OutputStream out = new FileOutputStream(f);
          String str = "zknu.jkx.czw";
          byte[] b = str.getBytes();
          // 1.循环把每一个字节一个个写入到文件中
          for (int i = 0; i < b.length; i++) {
               out.write(b[i]);
          }
          // 2.将byte数组写入到文件中
          out.write(b);          // 内容保存
          out.close();          // 关闭输出流
     }
}

```

程序用两种方式将所有字节写入到文件中，但是如果重新运行程序，就会覆盖文件中已有的内容。如果是在原文件中追加内容，就使用下面的构造方法。
```
public FileOutputStream(File file,boolean append)
```
append为true，表示在文件的末尾追加内容。

#### 字节输入流：InputStream类
InputStream类可以把内容从文件中读取出来。InputStream类本身是一个抽象类，必须依靠其子类实例化对象，对文件操作的子类为FileInputStream。

下面的示例演示了对文件的读取方式。
```java
import java.io.File;
import java.io.FileInputStream;
import java.io.InputStream;
public class InputStreamDemo {
     public static void main(String[] args) throws Exception{
          // 找到一个文件
          File f = new File("d:" + File.separator + "kj.txt");
          // 实例化--子类实例化父类
          InputStream in = new FileInputStream(f);
          byte[] b = new byte[1024];
          int len = in.read(b);
          // 1.循环把每一个字节一个个写入到文件中
          for (int i = 0; i < len; i++) {
               b[i] = (byte)in.read();
          }
          // 2.将byte数组写入到文件中
          in.close();          // 关闭输出流
          System.out.println(new String(b,0,len));
     }
}
```

### 字符流
Java中的一个字符占两个字节。Java提供了两个专门操作字符流的类：Reader和Writer。这两个类是字符流的抽象类，定义了字符流读取和写入的基本方法，各个子类会依其特点实现或覆盖这些方法。

#### 字符输出流：Writer类
Writer类对文件操作的子类是FileWriter类。

下面的示例演示了Writer类向文件中写入数据的方法。
```java
import java.io.File;
import java.io.FileWriter;
import java.io.Writer;
public class WriterDemo {
     public static void main(String[] args) throws Exception{
          // 找到一个文件
          File f = new File("d:" + File.separator + "kj.txt");
          // 实例化--子类实例化父类
          Writer out = new FileWriter(f,true);
          String str = "\r\ncomputer engineering dept";
          out.write(str);  // 内容保存
          out.close();      // 关闭输出流
     }
}
```

#### 字符输入流：Reader类
Reader类对文件操作的子类是FileReader类。

下面的示例演示了Reader类从文件中读取数据的方法。
```java
import java.io.File;
import java.io.FileReader;
import java.io.Reader;
public class ReaderDemo {
     public static void main(String[] args) throws Exception{
          // 找到一个文件
          File f = new File("d:" + File.separator + "kj.txt");
          // 实例化--子类实例化父类
          Reader reader = new FileReader(f);
          int len = 0 ;     // 用来记录读取的数据个数
          char[] c = new char[1024]; // 所有的内容读到此数组中
          int temp = 0; // 接收读取的每一个内容
          while ((temp = reader.read())!= -1) {
               // 将每次读取的内容给temp，temp的值等于-1，文件读完
               c[len] = (char)temp;
               len++;
          }
          reader.close();
          System.out.println("内容为：" + new String(c,0,len));
     }
}
```

### 字节流与字符流的区别
字节流与字符流在操作上非常类似，二者除了代码不同之外，最大的差别是操作时是否使用缓冲区（可理解为一段特殊的内存）。字节流在操作时不使用缓冲区，是文件本身直接操作的，而字符流在操作时使用缓冲区，即先通过缓冲区再操作文件。修改WriterDemo.java文件如下：
```java
import java.io.File;
import java.io.FileWriter;
import java.io.Writer;
public class WriterDemo01 {
     public static void main(String[] args) throws Exception{
          // 找到一个文件
          File f = new File("d:" + File.separator + "kj.txt");
          // 实例化--子类实例化父类
          Writer out = new FileWriter(f,true);
          String str = "\r\ncomputer engineering dept";
          out.write(str);           // 内容保存
          out.flush();                 // 刷新缓冲区
          // out.close();             // 关闭输出流
     }
}

```
如果不关闭输出流，就需要刷新缓冲区才能在文件中看到内容，读者可自行演示。因为所有文件在硬盘或在传输时都是以字节的方式进行的，而字符只有在内存中才会形成，所以在开发中字节流使用比较广泛。

## 转换流
Java JDK文档中的FileWriter类并不直接是Writer类的子类，而是OutputStreamWriter的子类；FileReader类并不直接是Reader类的子类，而是InputStreamReader的子类，两个子类中间都需要进行转换操作，这两个类就是字节流-字符流的转换类。

OutputStreamWriter类：将输出的字符流转换为字节流，即将一个字符流的输出对象变为字节流的输出对象。

·InputStreamReader类：将输入的字节流转换为字符流，即将一个字节流的输入对象变为字符流的输入对象。

无论如何转换和操作，最终都是以字节的形式保存在文件中。例如：

将字节输出流变为字符输出流。
```java
import java.io.File;
import java.io.FileOutputStream;
import java.io.OutputStreamWriter;
import java.io.Writer;
public class OutputStreamWriterDemo {
     public static void main(String[] args) throws Exception{
          File f = new File("d:" + File.separator + "kj.txt");
          // 实例化--字节流变为字符流
          Writer out=new OutputStreamWriter(new FileOutputStream(f));
          out.write("www.zknu.edu.cn");
          out.close();
     }
}
```

将字节输入流变为字符输入流。
```java
import java.io.File;
import java.io.FileInputStream;
import java.io.InputStreamReader;
import java.io.Reader;
public class InputStreamReaderDemo {
     public static void main(String[] args) throws Exception{
          File f = new File("d:" + File.separator + "kj.txt");
          // 实例化--字节流变为字符流
          Reader rd=new InputStreamReader(new FileInputStream(f));
          char[] c = new char[1024];
          int len = rd.read(c);
          rd.close();
          System.out.println("内容为：" + new String(c,0,len));
     }
}
```

### 打印流
在Java io包中，打印流提供了非常方便的打印功能，可以打印任何数据类型，如小数、整数、字符串等。打印流是输出信息最方便的类，主要包含字节打印流（PrintStream）和字符打印流（PrintWriter）。本节主要通过字节打印流（PrintStream）进行讲解。

字节打印流（PrintStream）是OutputStream类的子类，其中一个构造方法可以直接接收OutputStream类的实例，以便输出数据。例如：

```java
import java.io.File;
import java.io.FileOutputStream;
import java.io.PrintStream;
public class PrintStreamDemo {
     public static void main(String[] args) throws Exception{
          File f = new File("d:" + File.separator + "kj.txt");
          // 通过FileOutputStream实例化，向文件中打印输出
          PrintStream ps = new PrintStream(new FileOutputStream(f));
          ps.println("welcome you!");
          ps.println(3*3);
          ps.close();
     }
}
```

### 管道流
管道流的主要作用是可以进行两个线程间的通信，分为管道输出流（PipeOutputStream）和管道输入流（PipedInputStream）。如果要进行管道输出，就必须把输出流连到输入流上。

下面是验证管道流的示例。

```java
import java.io.* ;
public class PipedDemo{
     public static void main(String args[]){
          Send s = new Send() ;
          Receive r = new Receive() ;
          try{
               s.getPos().connect(r.getPis()) ;     // 连接管道
          }catch(IOException e){
               e.printStackTrace() ;
          }
          new Thread(s).start() ;               // 启动线程
          new Thread(r).start() ;               // 启动线程
     }
}
class Send implements Runnable{               // 线程类
     private PipedOutputStream pos = null ;          // 管道输出流
     public Send(){
          this.pos = new PipedOutputStream() ;     // 实例化输出流
     }
     public void run(){
          String str = "Welcome you!!!" ;          // 要输出的内容
          try{
               this.pos.write(str.getBytes()) ;
          }catch(IOException e){
               e.printStackTrace() ;
          }
          try{
               this.pos.close() ;
          }catch(IOException e){
               e.printStackTrace() ;
          }
     }
     public PipedOutputStream getPos(){          // 得到此线程的管道输出流
          return this.pos ;
     }
}
class Receive implements Runnable{
     private PipedInputStream pis = null ;          // 管道输入流
     public Receive(){
          this.pis = new PipedInputStream() ;     // 实例化输入流
     }
     public void run(){
          byte b[] = new byte[1024] ;          // 接收内容
          int len = 0 ;
          try{
               len = this.pis.read(b) ;          // 读取内容
          }catch(IOException e){
               e.printStackTrace() ;
          }
          try{
               this.pis.close() ;               // 关闭
          }catch(IOException e){
               e.printStackTrace() ;
          }
          System.out.println("接收的内容为：" + new String(b,0,len)) ;
     }
     public PipedInputStream getPis(){
          return this.pis ;
     }
}
```

程序运行结果如下：
```
接收的内容为：Welcome you!!!
```
示例中定义了两个线程对象：在发送的线程类中定义了管道输出流，在接收的线程类中定义了管道输入流。在操作时只需要使用PipedOutputStream类中提供的connect()方法就可以将两个线程管道连接在一起，线程启动后会自动进行管道的输入/输出操作。

### BufferedReader类和BufferedWriter类
BufferedReader类用于从缓冲区中读取内容，所有的输入字节数据都将放在缓冲区；BufferedWriter类用于写入数据到缓冲区。

BufferedReader类是Reader类的子类，使用该类可以以行为单位读取数据；BufferedWriter类是Writer类的子类，该类可以以行为单位写入数据。例如：

```java
import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.File;
import java.io.FileReader;
import java.io.FileWriter;
public class BufferedDemo {
     public static void main(String[] args) throws Exception{
          // 创建BufferedReader对象
          FileReader fr = new FileReader("d:\\example1.txt");
          File f = new File("d:\\example2.txt");
          // 创建文件输出流
          FileWriter fw = new FileWriter(f);
          BufferedReader br = new BufferedReader(fr);
          // 创建BufferedWriter对象
          BufferedWriter bw = new BufferedWriter(fw);
          String str = null;
          while ((str = br.readLine())!= null) {
               bw.write(str + "\n");     // 为读取的文本行添加回车
          }
          br.close();               // 关闭输入流
          bw.close();               // 关闭输出流
     }
}
```

### 数据操作流
Java io包中提供了两个与平台无关的数据操作流，分别为数据输出流（DataOutputStream）和数据输入流（DataInputStream）。通常数据输出流会按照一定的格式将数据输出，再通过数据输入流按照一定的格式将数据读入，这样方便对数据进行处理。

数据输出流（DataOutputStream）和数据输入流（DataInputStream）分别有各种writeXxx()方法和readXxx()方法对数据进行输出和读取。下面的示例演示了把订单数据通过数据输出流保存到文件，然后使用数据输入流从文件中读取出来的过程。
```java
import java.io.DataOutputStream ;
import java.io.File ;
import java.io.FileOutputStream ;
public class DataOutputStreamDemo{
     public static void main(String args[]) throws Exception{
          DataOutputStream dos = null ;          // 声明数据输出流对象
          File f = new File("d:" + File.separator + "order.txt") ;
                                        // 实例化数据输出流对象
dos = new DataOutputStream(new FileOutputStream(f)) ;
          String names[] = {"衬衣","手套","围巾"} ;     // 商品名称
          float prices[] = {98.3f,30.3f,50.5f} ;     // 商品价格
          int nums[] = {3,2,1} ;               // 商品数量
          for(int i=0;i<names.length;i++){          // 循环输出
               dos.writeChars(names[i]) ;          // 写入字符串
               dos.writeChar('\t') ;          // 写入分隔符
               dos.writeFloat(prices[i]) ;     // 写入价格
               dos.writeChar('\t') ;          // 写入分隔符
               dos.writeInt(nums[i]) ;           // 写入数量
               dos.writeChar('\n') ;          // 换行
          }
          dos.close() ;                         // 关闭输出流
     }
}
```
以上程序是将订单数据写入到order.txt文件中。下面的程序是从order.txt文件中读取数据。
```java
import java.io.DataInputStream ;
import java.io.File ;
import java.io.FileInputStream ;
public class DataInputStreamDemo{
     public static void main(String args[]) throws Exception{
DataInputStream dis = null ;                    // 声明数据输入流对象
                                        // 文件的保存路径
File f = new File("d:" + File.separator + "order.txt") ;
                                        // 实例化数据输入流对象
dis = new DataInputStream(new FileInputStream(f)) ;
          String name = null ;               // 接收名称
          float price = 0.0f ;                    // 接收价格
          int num = 0 ;                         // 接收数量
          char temp[] = null ;               // 接收商品名称
          int len = 0 ;                         // 保存读取数据的个数
          char c = 0 ;                         // '\u0000'
          try{
               while(true){
                    temp = new char[200] ;     // 开辟空间
                    len = 0 ;
                    while((c=dis.readChar())!='\t'){   // 接收内容
                         temp[len] = c ;
                         len ++ ;               // 读取长度加1
                    }
// 将字符数组变为String
name = new String(temp,0,len) ;
                    price = dis.readFloat() ;          // 读取价格
                    dis.readChar() ;               // 读取\t
                    num = dis.readInt() ;          // 读取int
                    dis.readChar() ;               // 读取\n
                    System.out.printf("名称：%s；价格：%5.2f；数量：
                              %d\n",name,price,num) ;
               }
          }catch(Exception e){}
          dis.close() ;
     }
}
```

### 对象流
Java提供了ObjectInputStream与ObjectOutputStream类读取和保存对象，它们分别是对象输入流和对象输出流。ObjectInputStream类和ObjectOutputStream类是InputStream与OutputStream类的子类，继承了它们所有的方法。

下面的示例是在D盘存在login.txt文件，实现用户密码的修改。
```java
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.io.Serializable;
public class ObjectDemo {
     public static void main(String[] args) throws Exception{
          User user = new User("sam", "8080");     // 创建user类的对象
          FileOutputStream fos=new FileOutputStream("d:\\login.txt");
          // 创建输出流对象，使之可以将对象写入文件中
          ObjectOutputStream obs = new ObjectOutputStream(fos);
          obs.writeObject(user);               // 将对象写入文件中
          System.out.println("写入文件的信息");
          System.out.println("用户名：" + user.name);
          System.out.println("密码：" + user.password);
          FileInputStream fis = new FileInputStream("d:\\login.txt");
          // 创建输入流对象，使之可以从文件中读取数据
          ObjectInputStream ois = new ObjectInputStream(fis);
          user = (User)ois.readObject();          // 读取文件中的信息
          user.setPassword("666666");          // 修改密码
          System.out.println("修改后的文件信息");
          System.out.println("用户名：" + user.name);
          System.out.println("密码：" + user.password);
     }
}
class User implements Serializable{
     String name;
     String password;
     User(String name,String password){
          this.name = name;
          this.password = password;
     }
     public void setPassword(String password) {
          this.password = password;
     }
}
```


