---
layout: post
categories: Redis
description: none
keywords: Redis
---
# Redis简介
Redis:REmote DIctionary Server(远程字典服务)。是由意大利人Salvatore Sanfilippo（网名：antirez）开发的一款内存高速**缓存**数据库。是完全开源免费的，用**C语言**编写的，遵守BSD协议，高性能的(**key/value**)**分布式内存数据库**，基于内存运行并支持**持久化**的**NoSQL**数据库。
Redis是一款开源的使用ANSI C语言编写、遵守BSD协议、支持网络、可基于内存也可持久化的日志型、Key-Value高性能数据库。

## Redis概述
Redis 是完全开源的，遵守 BSD 协议，是一个高性能的 key-value 数据库。

Redis 与其他 key - value 缓存产品有以下三个特点：

- Redis支持数据的持久化，可以将内存中的数据保存在磁盘中，重启的时候可以再次加载进行使用。
- Redis不仅仅支持简单的key-value类型的数据，同时还提供list，set，zset，hash等数据结构的存储。
- Redis支持数据的备份，即master-slave模式的数据备份。

## Redis优势

- 性能极高 – Redis能读的速度是110000次/s,写的速度是81000次/s 。
- 丰富的数据类型 – Redis支持二进制案例的 Strings, Lists, Hashes, Sets 及 Ordered Sets 数据类型操作。
- 原子 – Redis的所有操作都是原子性的，意思就是要么成功执行要么失败完全不执行。单个操作是原子性的。多个操作也支持事务，即原子性，通过MULTI和EXEC指令包起来。
- 丰富的特性 – Redis还支持 publish/subscribe, 通知, key 过期等等特性。

## Redis可以用来做什么
Redis 是互联网技术领域使用最为广泛的存储中间件，它是「R emote Di ctionary S ervice」的首字母缩写，也就是「远程字典服务」。Redis 以其超高的性能、完美的文档、 简洁易懂的源码和丰富的客户端库支持在开源中间件领域广受好评。

国内外很多大型互联网公司都在使用 Redis，比如 Twitter、YouPorn、暴雪娱乐、Github、StackOverflow、腾讯、 阿里、京东、华为、新浪微博等等，很多中小型公司也都有应用。也可以说，对 Redis 的了解和应用实践已成为当下中高级后端开发者绕不开的必备技能。

由 Redis 面试想到的在面试后端工程师 Redis 技能的时候，面试官通常问的第一个问题就是“Redis 能用来做什么？”，第一个回答往往都会是「缓存」。缓存确实是 Redis 使用最多的领域，它相比 Memcache 而言更加易于理解、使用和控制。

可是如果再进一步问“还有呢？”，大多数同学就会开始皱眉头，只有一小部分人会回答「分布式锁」。如果你就分布式锁再深入问下去，他们基本就会开始摇头：我们项目里面 Redis 的锁方法都是别人（应该是架构师）封装好的，拿过来直接使用，内部细节没有去了 解过，也没有必要了解。

对类似的场景，我深有体会。因为关于 Redis 的面试题，之前准备了很多，但是真正能用上的却很少。当面试的同学频繁地回复「不知道、没用过」的时候，再继续深入追问已经

毫无意义，这时候就需要切换话题了。偶尔遇上几个能持续很多回合的同学，他们总能使人眼前一亮。如果再拓展一下周边知识点，就会发现这些人往往也会有所涉猎，这时我在心中已经暗暗地对这位同学伸出了大拇指。

这样的面试经历事后也让我深刻反思：架构师的技能很高，对提升团队研发效率很有帮助，我们非常钦佩和羡慕。但是普通开发者如果习惯于在架构师封装好的东西之上，只专注

于做业务开发，那久而久之，在技术理解和成长上就会变得迟钝甚至麻木。从这个角度看，架构师也可能成为普通开发者的“敌人”，他的强大能力会让大家变成“温室的花朵”，一旦遇到环境变化就会不知所措。

其实很多业务场景，如果仅仅是会使用某项技术、框架，那是再简单不过了。但随着业务发展，系统的用户量、并发量涨上来之后，现有系统的问题就会层出不穷地暴露出来。如果不能深入地了解系统、技术和框架背后的深层原理，很多问题根本无法理解到本质，更谈不上解决，临时抱佛脚也于事无补。

所谓「授人以鱼不若授人以渔」，本小册的初衷和目标就是帮助后端开发者较为深入的理解 Redis 背后的原理和实践经验，做到知其然也知其所以然，为未来进阶成长为架构师做好准备。


## Redis安装

在Linux系统上安装并启动Redis的步骤（我的Redis安装在/data/component/redis目录下，每一步使用的命令标红加粗）：

- 进入目录，**cd /data/component/redis**
- 下载Redis，**wget http://download.redis.io/releases/redis-3.2.11.tar.gz**，Redis地址为http://download.redis.io/releases/redis-4.0.9.tar.gz
- 解压下载下来的tar包，**tar -zxvf redis-3.2.11.tar.gz**，解压完毕的文件夹名称为redis-3.2.11
- 进入redis-3.2.11，**cd redis-3.2.11**
- 由于我们下载下来的是源文件，因此使用**make**命令对源文件进行一个构建，构建完毕我们会发现src目录下多出了redis-benchmark、redis-check-aof、redis-check-rdb、redis-cli、redis-sentinel、redis-server几个可执行文件，这几个可执行文件后面会说到
- 由于上述几个命令在/data/component/redis/redis-3.2.11/src目录下，为了更方便地使用这几个命令而不需要指定全路径，配置一下环境变量。这里我是以非root用户进行登录的，因此配置用户变量，先执行**cd**命令回到初始目录，再**vi ./.bash_profile**，在path这一行加入**PATH=PATH:PATH:HOME/.local/bin:$HOME/bin:/data/component/redis/redis-3.2.11/src**，使用**:wq**保存并退出
- 使环境变量生效，执行**source ./.bash_profile**
- 使用redis-server即可启动redis，**redis-server /data/component/redis/redis-3.2.11/redis.conf**

不过这个时候我们的启动稍微有点问题，不是后台启动的，即ctrl+c之后Redis就停了：

为了解决这个问题，我们需要修改一下redis.conf，将Redis设置为以守护进程的方式进行启动，打开redis.conf，找到daemonize，将其设置为yes即可：

这个时候先关闭一下再启动，Redis就在后台自动运行了，关闭Redis有两种方式：

- redis-cli shutdown，这是种安全关闭redis的方式，**但这种写法只适用于没有配置密码的场景**，比较不安全，配置密码下一部分会讲
- kill -9 pid，这种方式就是强制关闭，可能会造成数据未保存

重启后，我们可以使用**ps -ef | grep redis**，**netstat -ant | grep 6379**命令来验证Redis已经启动。

**Redis登录授权**

上面我们安装了Redis，但这种方式是非常不安全的，因为没有密码，这样任何连接上Redis服务器的用户都可以对Redis执行操作，所以这一部分我们来讲一下给Redis设置密码。

打开redis.conf，找到"requirepass"部分，打开原本关闭的注释，替换一下自己想要的密码即可：

重启Redis，授权登录有两种做法：

- 连接的时候直接指定密码，**redis-cli -h 127.0.0.1 -p 6379 -a 123456**
- 连接后授权，**redis-cli -h 127.0.0.1 -p 6379**，**auth 123456**

在配置了密码的情况下，没有进行授权，那么对Redis发送的命令，将返回"(error) NOAUTH Authentication required."。




# 参考资料

Redis 官网：[https://redis.io/](https://redis.io/)

源码地址：[https://github.com/redis/redis](https://github.com/redis/redis)

Redis 在线测试：[http://try.redis.io/](http://try.redis.io/)

Redis 命令参考：[http://doc.redisfans.com/](http://doc.redisfans.com/)