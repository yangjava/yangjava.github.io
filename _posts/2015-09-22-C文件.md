---
layout: post
categories: [C]
description: none
keywords: C
---
# C文件
对文件操作中一些模糊不清的概念和文件读写操作中的易错点进行相应的讲解，如文件指针到底意味着什么，如何区分文件的读操作是否结束，如何选择读写函数，以及如何在文件的操作中进行出错检测等。

## 文件
所谓文件，通常指的是存储在外表介质上的一组相关信息数据的集合。可以从以下两个方面对文件进行分类。

### 根据文件的读写方式可分为随机文件和顺序文件
- 随机文件
对这类文件中数据的读写是随机的，只要按照相关的函数对所要读写的文件进行定位，就可以对其进行读写操作，即允许跳跃式地对所需要的文件位置的数据进行处理。
- 顺序文件
对这类文件的读写操作是顺序进行的，如果要对文件中某个位置的数据进行读写操作，那么必须也对它前面的数据进行相应的操作，不允许跳跃式地对数据进行处理。

### 根据文件中数据存放的格式可分为文本文件和二进制文件
- 文本文件
这类文件中数据的存储方式是将数据转换为相应的ASCII码来存放。例如，对于整数5236，按照文本文件的存储方式需要占用4字节。每个字符都用相应的ASCII码来存储，并占用1字节，所以5236总共占用4字节的大小。
- 二进制文件
这类文件中数据的存放都是按照二进制进行的。还是以5236为例，按照二进制来存放仅仅占用2字节。

对比文本文件和二进制文件的存储方式，可以发现，在采用文本文件时，存储的每个字符都要转换为ASCII码，所以比二进制文件花费了更多的转换时间，同时，所占用的存储空间也比二进制文件大，但是采用文本文件便于对单个字符进行处理，也便于输出。

## 文件指针
文件指针，指的是一种特殊类型的指针，该指针的特殊之处在于它指向的是文件，而不是之前讲解的一般数据类型。通过该指针可以对文件进行读写等相关操作。定义文件指针的一般形式如下：
```
FILE*文件指针变量名；
```
FILE类型是在stdio.h中声明的结构体类型，介绍一下VC++6.0下的FILE结构体类型，其形式如下：
```
struct_iobuf{
char*_ptr；
int_cnt；
char*_base；
int_flag；
int_file；
int_charbuf；
int_bufsiz；
char*_tmpfname；
}；

typedef struct_iobuf FILE；
```
上述FIEE结构体中每个成员的含义如下：
- _ptr字符指针表示文件输入的下一个位置；
- _cnt表示当前缓冲区的相对位置；
- _base字符指针表示文件的起始位置；
- _flag表示文件标志；
- _file表示文件的有效性验证；
- _charbuf表示缓冲区的检查，若无此成员，则不读取；
- _bufsize表示文件大小；
- _tmpfname表示临时文件名。
利用上面的FILE结构体类型定义的文件指针是一个FILE结构体类型的指针变量，通过该指针变量，可以访问它所执行的文件，进而对其进行读写操作。

## 文件的操作
对于文件的操作，一般有以下4个步骤：
- 定义文件指针；
- 打开文件；
- 读写文件；
- 关闭文件。

打开文件时使用fopen函数，其函数原型为：
```
FILE* fopen(const char* fname,const char* mode);
```
注意fopen函数的返回值是一个文件类型的指针，其中，参数fname是要打开的文件名，该参数可以带存储路径。参数mode指示文件的打开模式，指示文件打开的基本操作。

mode参数的取值主要由6个字符组合而成。以下是一些mode值的说明。
- r：以只读的方式打开文件，如果不存在，就返回NULL；
- r+：以读写方式打开文件，如果不存在，就返回NULL；
- a：追加文件并进行写操作，如果不存在，就创建文件，否则新增的内容被添加到文件的末端；
- rt：以只读方式打开一个文本文件；
- wt：以写方式打开一个文本文件，如果不存在，则新建该文件；
- rt+：以读写方式打开一个文件；
- wt+：以读写方式打开一个文件，如果不存在，则新建该文件。

对打开的文件进行读写操作之后，接下来对文件进行关闭操作。关闭文件使用的是fclose函数，其一般格式如下：
```
int fclose(FILE* fp);
```




























