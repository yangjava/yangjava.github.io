---
layout: post
categories: [Mongodb]
description: none
keywords: Mongodb
---
# MongoDB安装部署



## Mongodb安装
有关如何下载并安装MongoDB，请参阅[http://docs.mongodb.org/manual/installation/](http://docs.mongodb.org/manual/installation/)。

### Docker安装MongoDB
下面是使用Docker安装MongoDB
### 查看可用的 MongoDB 版本
访问 MongoDB 镜像库地址： https://hub.docker.com/_/mongo?tab=tags&page=1。
可以通过 Sort by 查看其他版本的 MongoDB，默认是最新版本 mongo:latest。
我们还可以用 docker search mongo 命令来查看可用版本：
### 取最新版的 MongoDB 镜像
```text
docker pull mongo:latest
```
### 运行容器
安装完成后，我们可以使用以下命令来运行 mongo 容器：
```text
$ docker run -itd --name mongo -v /data/mongo:/data/db -p 27017:27017  mongo:7.0.0 --auth
```
参数说明：
```text
-p 27017:27017 ：映射容器服务的 27017 端口到宿主机的 27017 端口。外部可以直接通过 宿主机 ip:27017 访问到 mongo 的服务。
--auth：需要密码才能访问容器服务。
--httpinterface  --rest	:如何需要http服务需要添加这些参数
```
### 安装成功
接着使用以下命令添加用户和设置密码，并且尝试连接。
```text
$ docker exec -it mongo mongo admin
# 创建一个名为 admin，密码为 admin 的用户。
```
MongoDB 6.0 及以上版本使用以下命令：
```text
docker exec -it mongo mongosh admin
```
然后创建用户
```text
>  db.createUser({ user:'admin',pwd:'admin',roles:[ { role:'userAdminAnyDatabase', db: 'admin'},"readWriteAnyDatabase"]});
# 尝试使用上面创建的用户信息进行连接。
> db.auth('admin', 'admin')
```
### 在Docker中部署mongodb集群
docker 部署mongo集群（replSet ）
```text
docker run -itd --restart=always --name mongo -p 27017:27017 mongo --replSet colonyReplSet
```
登录进容器，连接mongodb，并创建集群：（只需要在主节点执行）
```text
docker exec -it mongodb /bin/bash
```
进入mongodb
```text
> rs.initiate()

> rs.add("node002.example.com")
> rs.add("node003.example.com")
```
或者修改配置文件
```text
config={
	#注意这个id要和容器启动replSet 参数一样
	"_id" : "colonyReplSet",
	"version" : 1,
	"members" : [
		{
			"_id" : 0,
			"host" : "localhost:27017",
			"priority" : 6
		},
		{
			"_id" : 1,
			"host" : "localhost:27018",
			"priority" : 3
		},
		{
			"_id" : 2,
			"host" : "localhost:27019",
			"priority" : 2
		}
	]
}
```
查看状态
```text
rs.status()
```
