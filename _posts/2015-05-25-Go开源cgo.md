---
layout: post
categories: Go
description: none
keywords: Go
---
# Go开源cgo
Go语言通过自带的一个叫CGO的工具来支持C语言函数调用，同时我们可以用Go语言导出C动态库接口给其它语言使用。

## 最简CGO程序
真实的CGO程序一般都比较复杂。不过我们可以由浅入深，一个最简的CGO程序该是什么样的呢？要构造一个最简CGO程序，首先要忽视一些复杂的CGO特性，同时要展示CGO程序和纯Go程序的差别来。

下面是我们构建的最简CGO程序：
```
package  main
import   "C"

func  main() {

     println ( "hello cgo" )

}
```
代码通过  import "C"  语句启用CGO特性，主函数只是通过Go内置的println函数输出字符串，其中并没有任何和CGO相关的代码。

虽然没有调用CGO的相关函数，但是go build命令会在编译和链接阶段启动gcc编译器，这已经是一个完整的CGO程序了。

## 基于C标准库函数输出字符串
第一章那个CGO程序还不够简单，我们现在来看看更简单的版本：
```
package  main

//#include <stdio.h>

import   "C"

func  main() {

    C.puts(C.CString( "Hello, World\n" ))

}
```
我们不仅仅通过  import "C"  语句启用CGO特性，同时包含C语言的  <stdio.h>  头文件。

然后通过CGO包的  C.CString  函数将Go语言字符串转为C语言字符串，最后调用CGO包的  C.puts  函数向标准输出窗口打印转换后的C字符串。

相比“Hello, World 的革命”一节中的CGO程序最大的不同是：我们没有在程序退出前释放  C.CString  创建的C语言字符串；

还有我们改用  puts  函数直接向标准输出打印，之前是采用  fputs  向标准输出打印。

没有释放使用  C.CString  创建的C语言字符串会导致内存泄漏。但是对于这个小程序来说，这样是没有问题的，因为程序退出后操作系统会自动回收程序的所有资源。

## 使用自己的C函数
前面我们使用了标准库中已有的函数。现在我们先自定义一个叫  SayHello  的C函数来实现打印，然后从Go语言环境中调用这个  SayHello  函数：
































