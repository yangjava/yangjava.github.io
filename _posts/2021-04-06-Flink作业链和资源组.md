---
layout: post
categories: [Flink]
description: none
keywords: Flink
---
# Flink作业链和资源组
在Flink作业中，用户可以指定相应的链条将相关性非常强的转换操作绑定在一起，这样能够让转换过程上下游的Task在同一个Pipeline中执行，进而避免因为数据在网络或者线程间传输导致的开销。一般情况下Flink在例如Map类型的操作中默认开启TaskChain，以提高Flink作业的整体性能。Flink同时也为用户提供细粒度的链条控制，用户能够根据自己的需要创建作业链或禁止作业链。

## 作业链

### 禁用全局链条
用户能够通过禁止全局作业链的操作来关闭整个Flink作业的链条，需要注意这个操作会影响整个作业的执行情况，在选择关闭之前，用户需要非常清楚作业的执行过程，否则可能会出现一些意想不到的情况。`
```
StreamExecutionEnvironment.disableOperatorChaining()
```
关闭全局作业链后，创建对应Opecator的链条，需要用户事先指定操作符，然后再通过使用startNewChain()方法来创建，且创建的链条只对当前的操作符和之后的操作符有效，不影响其他操作，例如：
```
someStream.filter(...).map(...).startNewChain().map(...)
```
在上述过程中，新创建的作业链只针对两个map操作进行链条绑定，对前面的filter操作无效，如果用户需要创建，则可以在filter操作和map操作之间进行startNewChain()方法即可。

## 禁用局部链条
如果用户不想关闭整体作业算子上的链条，而是只想关闭某些操作符上的链条，可以通过disableChaining()方法来禁用当前操作符上的链条，例如：
```
someStream.map(...).disableChaining();
```
在上述过程中，只会禁用map操作上的链条，且不会对其他操作符产生影响。

## Slots资源组
Slot是整个Flink系统中所提供的资源最小单元，其概念上和Yarn中的Container类似，Flink在TaskManager启动后，会自动管理当前TaskManager上所能提供的Slot，在作业提交到Flink集群后，由JobManager进行统一分配Slots数量。在这里需要介绍的是Slot资源共享的问题，即多个Task计算过程中在同一个Slot中进行，这样能够对特定过程中的Tasks进行物理隔离，使其能够在同一个Slot中执行，对数据转换操作进行隔离。另外，如果当前操作符（operator）中所有input操作均具有相同的slot group，则该操作符会继承前面操作符的slot group，然后在同一个Slot中进行数据处理，如果不是则当前的操作符会选择默认的slot group("default")，然后经作业发送到对应的slot上执行。如果用户不显示指定slot group，则所有的操作符均在default slot group中执行操作，而默认情况slot相互之间没有隔离，故Task上的操作符执行可能会在不同的slot上转换执行。可以通过如下方法指定slot group：
```

```
