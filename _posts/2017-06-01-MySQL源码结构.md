---
layout: post
categories: [MySQL]
description: none
keywords: MySQL
---
# MySQL源码结构
MySql是比较早期的C/S架构，即一个MySql服务程序（MySqlId），一个是客户端，前者负责数据库的服务请示的处理和回馈，后者主要是提供连接数据库和命令操作等。

## 存储引擎
MySql提供支持的存储引擎很多，但主要用的有如下三种：

- MyISAM
对ISAM存储引擎进行扩展。在Web、数据仓储和其他应用环境下最常使用的存储引擎之一。MyISAM拥有较高的插入、查询速度，但不支持事务。

- InnoDB（默认）
此引擎为MySql默认的存储引擎选项，提供了事务安全表（ACID），行锁定和外键。它具有提交、回滚和崩溃恢复能力的事物安全（ACID兼容）的强大功能，能够支持巨大数量数据的高性能应用。

- Memory
类似于Redis，存储数据到内存中，主要是为了提供快速操作。


## 核心模块
MySQL 的源代码实际上相当庞大，因此本文将从基本架构及模块入手，简介 MySQL 的一些核心模块。
```
// MySQL 的基本架构
├── SQL parser（解析器）
├── Optimizer（优化器）
├── Caches and buffer（缓存和缓冲区）
├── Storage engines（存储引擎）
├── Connection layer（连接层）
├── Utilities（工具集）
```
从以上基本架构可以看出，MySQL 的大致结构。下面我们对其中几个比较常见的模块进行分析。
- SQL Parser 模块
SQL Parser 模块是 MySQL 的解析器，主要负责解析用户输入的 SQL 语句，并将其转化为可执行的命令。在 MySQL 中，SQL 语句可以分为不同的类别，包括 DDL（数据定义语言）、DML（数据操作语言）等。而 SQL Parser 模块也是根据这些语句的特性来进行分类处理的。例如，通过该模块可以将 ALTER TABLE 语句解析为添加、删除或更改某个表的列，从而对数据表进行修改。
- Optimizer 模块
Optimizer 模块是 MySQL 的优化器，主要负责对 SQL 执行计划进行优化。在优化器中，MySQL 会对查询语句进行分析，并根据其特征进行相应的优化。例如，MySQL 可以通过索引来加速查询，或通过查询优化器重新组织查询语句，以获得更高的效率。
- Storage Engines 模块
Storage Engines 模块是 MySQL 的存储引擎，主要负责数据的存储和读取。在 MySQL 中，可以通过多种存储引擎来存储数据，包括 InnoDB、MyISAM 等。不同的存储引擎之间具有不同的优缺点，因此在选择存储引擎时需要综合考虑需求、性能等方面的因素。

## 源码的结构
源码的下载可以在：https://dev.mysql.com/downloads/mysql/

基本结构如下：
- boost:这个版本是自带Boost的库相关文件的，放在此处，如果是其它的版本就没有这个文件夹
- client:客户端相关的软件和工具代码
- cmake:CMAKE相关的脚本命令文件
- components:组件工具
- Docs:文档文件夹
- doxyen_resources:doxyen工具相关资源
- extra:引入的一些其它包，如网络消息谁的SSL包以及一些小工具。
- include:源码用的相关的头文件放置的文件夹，但不包括存储引擎的头文件。
- libbinlogevents:解析Binlog的lib服务，5.7后提供。
- libbinlogstandalone:脱机配置CMAKE
- libmysql:可嵌入式的客户端API
- libservices:动态服务插件管理
- man:帮助文档
- mysql-test:服务端mysqlid的测试工具。
- mysys:MySql自己实现的数据结构和一些基本算法。如数组和链表等。
- packaging:打包相关
- plugin:插件管理文件夹，包括一些动态加入的插件。
- router:集群路由
- scripts:系统工具运行的脚本。
- share:共享信息，err和字符集
- source_downloads:
- sql:服务端的主要代码，包括main函数。
- sql-common:服务端和客户端通用的一些代码。
- storage:存储引擎相关文件。
- strings:字符串库
- support-files:.conf的示例文件和相关工具。
- testclients:客户框架测试。
- unittest:单元测试，这个搞程序的都知道。
- utilities:公用的一些文件，有ZLIB等
- vio:虚拟网络IO处理系统，不同平台或不同协议的网络通信API的二次封装。

## 体系结构
MySql的体系结构主要如下：

其主要分为以下几层：
- 连接管理层，包括连接池支持的各种组件
- 服务管理层，含管理服务和相关工具、接口、分析、优化等组件。
- 存储引擎，含各种以插件提供的数据存储引擎。
- 文件存储层，含各种实际落到硬盘的物理文件。










































































































































































