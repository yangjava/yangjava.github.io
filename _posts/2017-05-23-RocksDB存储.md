---
layout: post
categories: [SQL]
description: none
keywords: SQL
---
# RocksDB存储

## 简介
Rocksdb作为一款底层存储引擎, 已经被各大明星项目所采用。尤其是在分布式存储系统领域，例如NewSQL数据库TiDB，再例如备受瞩目的Libra, 甚至绝大多数的分布式存储以及区块链项目,都是用的Rocksdb或者Leveldb, 而建立在Leveldb之上的Rocksdb成为更优的选择。

截止今天，已经有成千上完的应用基于Rocksdb构建，同时，随着分布式技术的不断演进与普及，rocksdb作为一款优秀的底层存储引擎，也将被更多的系统所采用。

而理解区块链，了解分布式系统，尤其是分布式存储，Rocksdb就是不得不探讨的课题。 今天，这里我不过多的深入到Rocksdb的原理之中，我只是简单介绍一下，如何在我们的项目中使用Rocksdb作为底层存储，由于Rocksdb是利用C++编写的，所以我这里主要讲一下，如何在Go语言中使用Rocksdb，如何利用Rocksdb构建一个基于Raft协议的分布式k-v数据库。 

当然这里面，每一个点其实都很难，无论是Raft协议还是Rocksb存储引擎，其本身都很复杂，所以文章里不会涉及到底层算法的实现，主要围绕应用来展开，包括raft算法，后续也不会实现，只是如何使用现有的go语言的raft实现，这样难度会下降很多，便于大家直观的理解rocksdb是怎么一回事，raft是怎么一回事。分布式存储，分布式k-v又是怎么一回事。

## 理论简介
Rocksdb起源于FaceBook, 是facebook基于leveldb构建的一个存储引擎，而它可以在一系列的存储介质上进行工作。它是一个C++ K-V存储库，它不仅支持点查询而且支持范围查询，同时保证了事务的ACID特性。Rocksdb非常灵活，可以根据环境，存储介质(内存、闪存、硬盘或者远程存储)进行配置，有很多可调节的参数。它支持多种压缩算法，同时提供了很多工具用于调试，此外还有具有自适应算法能力。

## 高性能
Rocksdb其核心特点之一就是高性能。 它支持有效的点查找以及范围查找，兼具高随机读和高随机写性能。同时它的体系结构设计可以支持调整不同的工作负载和硬件的折衷方案。

## 针对快速存储优化
RocksDB针对快速，低延迟的存储（例如闪存驱动器和高速磁盘驱动器）进行了优化。 RocksDB充分利用了闪存或RAM提供的高读写速率的全部潜力

## 强适应性
RocksDB可适应不同的工作负载。从MyRocks之类的数据库存储引擎到应用程序数据缓存到嵌入式工作负载，RocksDB均可用于各种数据需求。

## 基本和高级数据库操作
RocksDB提供基本的操作，例如打开和关闭数据库，读写更高级的操作，例如合并和压缩过滤器。

## RocksDB应用
基于以上的背景，以及rocksdb的特性，利用rocksdb构建一个存储系统就变得非常方便，同时我们也能很快达到我们想要的性能，下面我们简单介绍下rocksdb的使用，以及如何利用rocksdb构建一个k-v数据库，后续我们会进一步引入raft算法，实现一个基于raft分布式协议的分布式k-v存储数据库。

## 基于RocksDB实现K-V存储
在具体实现k-v存储之前，首先了解一下如何在go语言中使用rocksdb，由于rocksdb是利用C++编写的，所以要使用rocksdb，我们就需要额外做一些事情，好在go语言中可以直接调用C++库, 但在这里我们为了使用方便，不会直接在Go语言中调用C++接口，而是基于社区已经封装好的gorocksdb进行操作。 当然，如果对Go语言如何使用C++库感兴趣，可以直接读gorocksdb的源码，这个库本身就是最好的例子。不仅可以熟悉Go语言中C++的使用，而且可以熟悉rocksdb的API接口，可谓是一举两得，这里由于精力跟篇幅所限，不做分析演示了。

## rocksdb安装
如果是Mac 直接运行 brew install rocksdb 就可以了，其他系统的安装自行Google，有问题留言就可以。

首先看一个简单使用案例