---
layout: post
categories: [C]
description: none
keywords: C
---
# C语言环境
C程序由许许多多的标识符、关键字和操作符等组成。C语言规定了简单有效的语法规则并将它们组合在一起，串成一个个有丰富功能的程序。

## C程序简介
通过简单的程序使读者了解C程序更多的特点，建立起C程序更丰满的轮廓。

输出一个正方形，实现代码如下所示。
```
  #include <stdio.h>                  /* 包含文件 */
                                      /* 空行 */
  int main(void) {                    /* main函数的声明，下面都为main函数的函数体 */
    /* 使用printf语句逐行输出正方形 */
    printf("* * * * *\n");            /* 输出第1行 */
    printf("*       *\n");            /* 输出第2行 */
    printf("*       *\n");            /* 输出第3行 */
    printf("*       *\n");            /* 输出第4行 */
    printf("* * * * *\n");            /* 输出第5行 */                                   
                                      /* 空行 */
    return 0;                         /* 返回语句 */
  }
```
本程序实现了打印出一个正方形的功能。`{}`函数体的内容，是程序功能的实现主体。每一行都是一个函数调用语句，调用了`printf`函数，其功能为打印字串。

字串内容为“*****\n”，这个字串输出到屏幕时会将其中的\n处理为换行，其余字符按原样输出。 空行是为了隔开功能不同的两个程序段而设置的。

C99标准规定无形参的main函数的声明要写为“int main(void)”，且要有“return 0;”语句。

简单地展示了C语言中一些操作符、变量和数据类型
```
  #include <stdio.h>             /* 包含文件 */
                                 /* 空行 */
  int main(void) {               /* main函数声明 */
    /* 定义两个整型变量 */
    int a = 3;                   /* 定义并初始化a */
    int b = 7;                   /* 定义并初始化b */
  
    /* 定义两个浮点型变量 */
    double c = 2.4;              /* 定义并初始化c */
    double d = 7.4;              /* 定义并初始化d */
  
    /* 使用操作符进行计算 */
    b = b + a;                   /* 对b赋值 */
    d = c * d;                   /* 对d赋值 */
  
    /* 输出各个变量的值 */
    printf("a = %d\n", a);       /* 输出a的值 */
    printf("b = %d\n", b);       /* 输出b的值 */
    printf("c = %d\n", c);       /* 输出c的值 */
    printf("d = %f\n", d);       /* 输出d的值 */
  
    return 0;
  }
```
- 定义了两个double型变量c和d，并分别赋值为2.4和7.4，其中，2.4和7.4为两个double型常量。
- 调用printf函数，输出4个变量的值，在这里，printf函数用字符串外的数值替换字符串中的内容后输出。
- 注释语句，用来说明其后C语句的简要功能，以提高程序可读性。

## C程序的特点
从以上两个程序可以看到C程序的一些简单特点。

- C程序开头一般都有一些以#include开头的预处理语句，它的作用是用来包含一些外部文件；
- 都含有一个main函数，它是程序的执行入口；
- main函数都有以下声明：
```
int main(void)
```
- 程序的执行主体都放在main函数的函数体中；
- 变量必须在定义后才能使用；
- 可以使用一系列的操作符对变量进行操作；
- 可以调用函数来执行一些功能，比如，使用printf函数来输出变量的值；
都含有如下返回函数值的return语句：
```
return 0;
```
- 程序执行过程，从main函数开始，到它的return语句结束；
- 一般有适当的注释语句，以辅助说明语句功能；
- 在不同程序段间要适当地加空行，使程序结构清晰；
- 程序语句要有良好的缩进风格，以提高代码可读性。

## C程序的执行步骤
从C程序代码到输出程序结果之间，其过程是怎么样的呢？这个过程需要经历编译、链接和运行三个步骤。

### 编译
编译工作是由编译器完成的。由于C程序代码不能被机器直接识别，因此，首先要将C程序代码转换为机器码。

编译过程就是把C程序翻译成机器认可的机器码的过程。这个过程又可以分为预编译、编译阶段、优化阶段和汇编阶段四个部分。

- 预编译也叫预处理，就是在正式编译前所做的工作。C程序中的预处理命令都在这个阶段完成，预编译完成的基本上是对源程序的“替代”工作，如“#include<stdio.h>”，就是使用文件“stdio.h”的内容替换该命令。
- 编译阶段负责对预编译后的C程序进行词法分析和语法分析，C程序中的词法错误和语法错误会在这里被发现。确认所有语句符合词法规则和语法规则后，编译器会把C程序转换为汇编代码或等价的中间代码。
- 为生成更优秀的编译结果，编译器在编译过程中可能会对程序进行一系列优化处理，优化工作在整个编译过程中都可能发生。
- 汇编阶段负责把中间代码或汇编代码翻译成目标机器代码，保存在目标文件中。

### 链接
经过编译后得到的目标文件中的机器码是相互独立的，因此，需要链接器将它们组合在一起，并解析它们之间的交叉引用。C程序如果调用了函数库，这个过程中就会将调用命令与被调用的函数库链接一起。

例如，其为C语言标准函数，这个阶段会将调用命令与函数库中的函数相链接。如果找不到调用的目标函数，就会发生链接错误。

### 运行
完成链接后，就可以得到一个可执行文件，可以直接运行。运行后，就可以得到程序结果。如果程序中有屏幕输出的命令，便可以在屏幕上看到打印内容。


## C程序开发环境
当前流行的C语言的开发环境有很多种，本章选择其中的四种加以介绍，其余开发环境的使用基本类似。下面将以编写输出“Hello, world!”的C程序为例，讨论如何使用Turbo C、Visual C++ 2005和GCC 3.2.2进行C语言编程。

作为C语言的初学者，只需要掌握其中一种开发环境的使用即可。

### Turbo C
Turbo C历史十分悠久，是著名软件公司Borland公司的产品，曾经是DOS时代最强大的C语言开发工具。1987年，Borland公司首次推出Turbo C产品，即1.0版本，其中使用了焕然一新的集成开发环境，使用了一系列下拉式菜单，即文本编辑、程序编译、链接以及程序运行一体化，大大方便了程序的开发。

1988年推出的Turbo C 1.5版本中增加了图形库和文本窗口函数库等，而Turbo C 2.0则是该公司在1989年出版的。

由于Turbo C是DOS时代的产品，其主要操作都需要使用键盘来进行。使用Turbo C进行C编程，需要以下步骤：
- 进入Turbo C，可以看到欢迎画面
- 首先要创建新文件，并编写程序。创建新文件的方法有两种：

使用【New】选项

使用组合键【Alt+F】打开【File】下拉菜单。再使用键盘上、下键选择其中的【New】选项，或者直接按【N】键，打开一个新文件，然后就可以进行C编程。由于未给新文件起名，在文件中输入程序后，必须将其保存为file1.c。当然，也可以在打开新文件后马上保存为file1.c。保存的方法是：选择【File】下拉菜单中的【Save】选项，快捷键为【F2】，这时会弹出一个要求输入文件名的窗口，输入文件名“file1.c”后回车，即可保存文件。也可以选择【File】菜单中的【Write to】选项，同样会出现要求输入文件名的窗口，输入文件名即可将输入内容另存为一个新的文件。

使用【Load】选项

另外一种方法是选择【File】下拉菜单中的第一项【Load】，然后输入文件名，如果存在该文件，就会打开已有文件，否则会以该文件名新建一个文件，快捷键为【F3】。这种方法只需要一个快捷键就可以打开并保存一个新文件，因此比较方便。

编写完程序file1.c后，要对C程序进行编译链接。使用组合键【Alt+C】，打开【Compile】菜单，可以看到命令【Compile to OBJ】和【Make EXE file】（快捷键为【F9】），分别为编译和链接命令，依次调用即可。也可以直接使用【Make EXE file】命令，即【F9】键，同时完成编译和链接。如果存在编译错误和链接错误，会在相应信息栏中显示。在编译和链接过程中，会生成文件“file1.obj”。链接完成后，生成可执行文件“file1.exe”。

- 运行程序有两种方式。
第一种在操作系统的命令行模式下进行。首先切换到操作系统的命令行模式，使用组合键【Alt+F】打开【File】下拉菜单，选择其中的【OS shell】选项，就可以切换到命令行模式。在命令行输入无.exe扩展名的文件名“file1”或全称“file1.exe”，便可以运行“file1.exe”。若要在命令行下显示文件内容，可以输入“type file1.c”

第二种在编辑模式下运行，在输出模式下查看结果。首先使用组合键【Alt+R】打开【Run】菜单，选择第一项【Run】运行程序，也可使用快捷键【Ctrl+F9】。然后选择【Run】下拉菜单中的最后一项【User Screen】进入输出模式，也可以使用快捷键【Alt+F5】，便可以看到输出结果。之后按任意键可以返回编辑模式。

## Visual C++ 2005
Visual Studio 2005是Microsoft公司推出的功能强大的可视化软件开发工具。其中，包含了Visual C++ 2005，它是Microsoft公司Visual C++系列产品2005年的最新版本。Visual C++ 2005是本书程序的主要开发和演示环境。

在Visual C++ 2005中创建C程序，需要先创建相应的工程，然后再向工程中添加C程序，步骤如下。

① 打开Visual C++ 2005。

② 打开主菜单【File】，选择下拉菜单中的【New】选项，再选中弹出菜单中的【Project】选项，可以得到【New Project】页面；也可以直接使用快捷键【Ctrl+Shift+N】。

③ 在左侧【Project types】一栏中选择【General】选项，再从【Templates】页面中选择【Empty Project】选项。在页面下方有几个供填写的文本框，其中，【Name】文本框中填写要创建的工程名称，如“project1”；【Location】为创建的工程存放的地址，可以自行设定；在【Solution】的下拉列表中选择“Create new Solution”选项。填完后单击右下侧的【OK】按钮，完成一个空工程的创建（实际上创建的是一个只含有一个工程的方案）。

④ 选择【View】下拉菜单中的【Solution Explorer】选项，或者直接使用快捷键【Ctrl+Alt+L】，可以看到【Solution Explorer】页。它描述了工程结构，图中的工程中只包含了三个文件夹“Header Files”、“Resource Files”和“Source File”，分别存放头文件（.h文件）、工程中需要的资源文件和源文件（.c文件）。

⑤ 创建好新工程后，便可以创建C程序。单击菜单栏中的【Project】图标，选择下拉菜单中的【Add New Item】选项，可以得到【Add New Item】标签页。还可以在【Solution Explorer】标签页中的“Source Files”上右击，或者直接使用快捷键【Ctrl+Shift+A】，也可以得到【Add New Item】标签页。

⑥ 在【Add New Item】标签页中，选择左侧的【Categories】页中的【Code】选项，再从右侧【Templates】选项中选择【C++File (.cpp)】一栏。这样就可以创建.c文件。在下侧的【Name】文本栏中输入完整的文件名，例如file1.c。【Location】一栏在一般情况下不用更改，会自动设定为新建的工程目录。单击本标签页右下角【Add】按钮。再次查看【Project Explorer】页（快捷键为【Ctrl+Alt+L】），可以看到文件夹“Source Files”下多了一个.c文件“file1.c”。

⑦ 完成上述步骤后，便建立了一个只含有一个.c文件的工程，这样就可以编写简单的C程序了。

下面介绍如何在Visual C++ 2005中运行C程序。过程十分简单，有以下两个步骤：

① 选择菜单【Build】下的【Build Solution】菜单项（快捷键为【F7】），或【Rebuild Solution】（快捷键为【Ctrl+Alt+F7】）、【Build工程名】、【Rebuild工程名】菜单项，都可以编译链接写好的C程序。

② 选择【Debug】菜单中的【Start Without Debugging】选项或使用快捷键【Ctrl+F5】，就可以运行C程序。


### GCC 3.2.2
GCC是GNU提出的一款功能强大、性能优异的C程序编译器，其全称为“GNU C Compiler”。GCC提供了在多种硬件平台上编译可执行程序的功能，其执行效率与其他同类编译相比要高20%~30%。

GNU的全称为“GNU's Not UNIX”，这是一个很有趣的含有递归的名字。GNU计划，是由Richard Stallman在1983年9月27日公开发起的。它的目标是创建一套完全自由的操作系统。Richard Stallman在他发表的《GNU宣言》等文章中解释，发起该计划的理由之一是要“重现当年软件界合作互助的团结精神”。GNU是一个伟大的计划，对世界软件业影响巨大。其官方网页为“www.gnu.org”。

在Linux下，使用GCC 进行C编程需要以下步骤。

① 选择一个文本编辑器，这里以vim作为编辑环境。在Linux终端上输入命令：
```
vim file1.c
```

其功能为：使用vim打开file1.c文件。如果文件不存在，则创建该文件。

② 在vim中输入程序。

③ 使用GCC编译链接该程序，输入命令：
```
gcc -o hello file1.c
```
生成可执行的二进制文件hello。其中，“-o hello”的作用是将file1.c的可执行文件命名为“hello”。如果不写-o选项，即：
```
gcc file1.c
```

得到的可执行文件则为“a.out”，这是GCC可执行文件的默认名。

④ 运行二进制文件，输入命令：
```
./hello
```












