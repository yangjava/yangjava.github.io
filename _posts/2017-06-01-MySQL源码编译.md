---
layout: post
categories: [MySQL]
description: none
keywords: MySQL
---
# MySQL源码编译
源码编译mysql5.7需要这两个包，我们需要准备好mysql-5.7.19.tar.gz boost_1_59_0.tar.gz

## 准备c++ boost库，这个包不需要编译
```
tar xvf boost_1_59_0.tar.gz
 
mv boost_1_59_0 /usr/local/boost
```
源码安装MySQL5.7
```
tar xvf mysql-5.7.19.tar.gz -C /usr/local/src
 
cd /usr/local/src/mysql-5.7.19/
```
安装相关编译工具和依赖包（yum一定要正常）
```
yum install -y gcc-c++ cmake ncurses-devel
```
创建mysql用户来运行MySQL数据库，但是又不创建mysql的家目录并且不允许这个账户能登陆系统。
```
groupadd -g 27 mysql 
useradd mysql -u 27 -g mysql -M -s /sbin/nologin
```
创建存放mysql数据的目录并且改变相关权限
```
mkdir -p /data/mysql 
chown mysql:mysql /data/mysql
```
预编译mysql
```
cmake -DCMAKE_INSTALL_PREFIX=/usr/local/mysql57 -DMYSQL_DATADIR=/data/mysql -DDEFAULT_CHARSET=utf8 -DDEFAULT_COLLATION=utf8_general_ci -DMYSQL_TCP_PORT=3306 -DMYSQL_UNIX_ADDR=/tmp/mysql.sock -DMYSQL_USER=mysql -DWITH_MYISAM_STORAGE_ENGINE=1 -DWITH_INNOBASE_STORAGE_ENGINE=1 -DDOWNLOAD_BOOST=1 -DWITH_BOOST=/usr/local/boost -DWITH_INNODB_MEMCACHED=ON
```
编译 （时间会有点长，十分钟左右）
```
make
```
编译安装
```
make install
```
我们将原来的my.cnf文件备份一下，重新给它编写一个
```
mv /etc/my.cnf /etc/my.cnf.bak
cat >/etc/my.cnf<<EOF
[client]
port=3306
socket=/data/mysql/mysql.sock

[mysqld]
character-set-server=utf8
collation-server=utf8_general_ci

skip-name-resolve
user=mysql
port=3306
basedir=/usr/local/mysql57
datadir=/data/mysql
tmpdir=/tmp
socket=/data/mysql/mysql.sock

log-error=/data/mysql/mysqld.log
pid-file=/data/mysql/mysqld.pid 
EOF
```
mysql命令调优

将mysql命令的以绝对路径的形式追加到/etc/profile文件里，然后刷新这个文件，mysql命令就能tab出来了
```
echo "export PATH=$PATH:/usr/local/mysql57/bin" >> /etc/profile 
source /etc/profile
```
初始化mysql数据库
```
/usr/local/mysql57/bin/mysqld --defaults-file=/etc/my.cnf --initialize --user=mysql
```
启动并查看数据库
```
/usr/local/mysql57/support-files/mysql.server start
 
/usr/local/mysql57/support-files/mysql.server status
```
mysql第一次登录密码是需要在mysqld.log里面查找的，第一次登录上去就立刻要更改密码，不然mysql不允许你进行其他操作。
```
cat /data/mysql/mysqld.log | grep password
```
登录mysql并且更改密码
```
mysql -uroot -p'tUwHx%h(d1tt'
 
ALTER USER 'root'@'localhost' IDENTIFIED BY '123456';
 
flush privileges;
```
到这里，源码编译MySQL5.7就完美结束了，是不是很简单呢？