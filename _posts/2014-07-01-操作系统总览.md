---
layout: post
categories: OS
description: none
keywords: OS
---
# 操作系统总览

## 计算机体系结构（Computer Architecture）
硬件是软件的基石，所有的软件功能最终都是由硬件来实现的。无论是复杂的数学运算、图像处理，还是简单的文本显示、编辑，其软件实现首先都是架构在硬件之上，然后由此逐层不断抽象堆叠而起的。因此，要彻底理解软件，没有一定的硬件基础是不行的。

当然，硬件是一个笼统而宽泛的概念。我们不能强制要求软件工程师都能理解每个电子元器件的电气特性，或者先学习电路排版作图然后编写程序。这就像汽车与驾驶员的关系：要求驾驶员必须透彻理解发动机的原理和内部构造才能开车显然是行不通的，但能了解发动机工作机理的驾驶员就一定能在开车的过程中受益匪浅。

计算机体系结构作为一门学科，是软件和硬件的抽象体，也是所有开发者的入门课。它对于我们理解程序设计，特别是操作系统原理，有十分重要的意义。

## 冯·诺依曼结构
冯·诺依曼（Von Neumann）是20世纪公认的最伟大的科学家之一。他的贡献领域相当广泛，Von Neumann architecture就是其中之一。

冯·诺依曼结构（Von Neumann Architecture）又被称为“冯诺依曼模型”或者“普林斯顿结构”，起源于Neumann在1945年发表的一篇关于EDVAC（Electronic Discrete variable Automatic Computer，电子离散变量自动计算机）的论文。

就是在这篇文章中，他提出了两个对计算机领域产生了深远影响的观点。
- 采用二进制，抛弃十进制
根据电子元件的工作特点，冯诺依曼提出了使用二进制的设想。他认为这将极大简化计算机设备的逻辑线路，后来的事实也验证了他的这一推断。
- 程序存储（stored-program）
除了二进制，他还建议计算机能实现程序存储和程序控制。具体而言，程序指令和数据都存放在同一内存储器中，因此它们的宽度是一样的。不过程序与数据共享同一总线在一定程度上也成了制约冯诺依曼机器的瓶颈。

冯诺依曼结构中包含了运算器、控制器、输入输出设备等元素

## 哈佛结构
值得一提的是，哈佛结构（Harvard Architecture）并不是作为冯诺依曼结构的对立面出现的；相反，它们都属于stored-program类型体系。区别就在于前者的指令与数据并不保存在同一个存储器中，即哈佛结构是对冯诺依曼结构的改进与完善。

由于取指令和数据无法同步进行，冯诺依曼结构的执行速率并不占优势。而采用哈佛结构的计算机由于指令和数据的单独存储，可以在执行操作的同时预读下一条指令，所以在一定程度上可以提高其吞吐量。

哈佛结构的缺点在于构架复杂且需要两个存储器，因而通常会被运用在对速度有特殊需求且成本预算相对较高的场合。目前市面上采用哈佛结构的芯片包括ARM公司的ARM9、ARM11，以及ATMEL公司的AVR系列等。

不论是何种结构，它们所包含的基本元素都是不变的，即：
- CPU（中央处理器）；
- 内存储器；
- 输入设备；
- 输出设备。
其中输入和输出设备一般会统称为I/O设备（外存储器实际上也归于这一类）。因而，最后可以把计算机结构简化为：
- 中央处理器；
- 内存储器；
- I/O设备。
无论是哪款操作系统（如Windows、Linux、Android等），都是建构在计算机体系结构之上的。脱离了这一点，操作系统就会变成“无源之水”。

## 什么是操作系统
计算机操作系统是负责管理系统硬件，并为上层应用提供稳定编程接口和人机交互界面的软件集合。

操作系统（Operating System,OS）是管理系统资源、控制程序执行、改善人机界面、提供各种服务、合理组织计算机工作流程和为用户有效使用计算机提供良好运行环境的一种系统软件。

根据定义，操作系统对资源进行管理。计算机系统中有哪些资源呢？其主要有两类资源：硬件资源和软件资源。硬件资源主要包括：中央处理器（CPU）、内存、外存、输入/输出（I/O）设备。硬件通过主板连接在一起，可以相互通信，协调工作。

计算机系统中的软件资源包括程序、数据和文档。这些软件资源存放在外存上，使用时复制到内存中。

操作系统课程内容结构正是从操作系统资源管理角度来组织的，包括处理器管理（进程管理）、存储管理（管理硬件内存）、设备管理（管理输入/输出设备）、文件管理（管理程序、数据和文档）。

## 操作系统的资源管理技术
操作系统对计算机系统中的资源进行管理。如何管理资源呢？操作系统主要采用如下3种资源管理技术。
- 资源复用
资源复用是指多个进程共享物理资源，包括分割资源为较多更小单位的空分复用和分时轮流使用资源的时分复用。进程是有资格获得系统资源的独立主体。
- 资源虚化
资源虚化指利用一类事物模拟另外一类事物，造成另外一类事物数量更多或容量更大的假象。
- 资源抽象
资源抽象是指利用软件封装复杂的硬件或软件设施，简化资源应用接口的一种资源管理技术。

资源复用和资源虚化的目的都是解决物理资源不足的问题；资源抽象解决的是物理资源的易用性问题。

在某种意义上可以说，操作系统的作用就是通过对计算机的各种硬件（包括处理器、存储器、输入设备、输出设备等）进行虚拟来实现的。

下面列举有关虚拟的例子。
- 虚拟处理器。
多任务操作系统的进程管理功能通过多道程序设计技术将一台物理处理器虚拟成若干台逻辑处理器，从而在单处理机系统中同时运行多道程序。
- 虚拟存储器。
操作系统的虚拟存储管理功能通过进程在内外存之间的对换、部分装入即可运行等操作，虚构了一个比实际内存空间大得多的编程空间，从而能够运行比内存空间大的程序，能够并发运行更多道的程序。
- 虚拟设备。
操作系统的I/O设备管理功能通过虚拟操作屏蔽了显示器、打印机、扫描仪、键盘和鼠标等设备的物理细节，使得用户可以使用统一的I/O命令、统一的界面来对不同的外部设备进行数据的输入/输出操作。
- 文件管理功能。
操作系统的文件管理功能将磁盘抽象成一组命名的文件，用户通过文件操作，按文件名来存取信息，不必涉及诸如数据物理地址、磁盘记录命令、移动磁头臂、搜索物理块及设备驱动等物理细节，便于使用，效率更高。
- 窗口管理软件。
操作系统的窗口管理软件把一台物理屏幕改造（虚拟）成多个窗口，每个应用可以在各自的窗口中操作，用户可以在窗口环境中方便地与计算机交互。

## 操作系统运行程序的服务
操作系统提供的最重要的服务是运行程序。操作系统如何为运行程序服务？来看下所示的一个C语言程序。
```

```
该程序编译链接后存放于磁盘（外存）上。当用户输入程序名或在图形用户界面中双击程序名（使用操作系统提供的用户接口）后，操作系统到磁盘上寻找该程序所在扇区（用到操作系统的文件管理功能），根据其大小分配内存空间（用到操作系统的存储管理功能），将其加载到该内存空间（用到装入功能）。

在加载程序的过程中，根据程序要装入的内存起始位置，操作系统可以将程序中的逻辑地址转变为内存物理地址。为了管理程序，不使程序运行失控，操作系统还会为该程序创建了一个进程控制块（Process Control Block, PCB）,PCB如同进程的户口本或身份证一样。PCB和所加载的用户程序代码及数据构成一个执行实体，称为进程。

进程是一个动态实体，随着指令的执行改变资源状态及其自身。计算机中可能同时存在多个已经运行而尚未终止的进程，而处理器通常只有一个，处理器应该分配给多个进程中的哪一个属于操作系统的进程调度功能。新建进程未必能够马上获得处理器而投入运行状态，随着等待时间的延长，新进程的优先级会逐渐升高，最终成为最有资格获得处理器的进程而使处理器转入运行状态。

当执行到语句scanf（“%d%d”,&a,&b）；时，进程需要从键盘获得数据，键盘属于输入设备，键盘的操作涉及操作系统的设备管理功能，该功能将键盘复杂的机械特性封装起来，对用户提供的接口仅显示输入数据需要送达的内存单元。这句话的实质是通过键盘向内存变量赋值。键盘的访问在高层被转化为内存的访问。设备管理功能的资源抽象技术简化了键盘访问接口，使用户无需直接与键盘端口打交道，无需知道端口地址即可使用键盘功能输入数据。

当执行到语句printf（“a+b=%d\n”,a+b）；时，进程需要向显示器输出计算结果。显示器属于输出设备，显示器的输出操作涉及操作系统的设备管理功能，该功能将显示器复杂的机械特性和底层访问端口封装起来，仅向用户提供要输出的数据来自哪个接口。显示器的访问被操作系统设备管理功能抽象为内存的访问。

最后，执行return 0；语句，进程结束，将处理器控制权交还给操作系统，操作系统回收结束进程的内存空间及其他资源。

通过该程序加载执行到结束的过程分析，可以看到：该程序的执行获得了操作系统进程管理服务、存储管理服务、设备管理服务和文件管理服务。

## 操作系统的功能
操作系统的功能体现为资源管理功能。根据硬件类别，操作系统功能包括：处理器管理功能、存储管理功能、设备管理功能、文件管理功能及网络与通信管理功能。其中包含的详细内容将在各章节阐述，在此预览其梗概。

### 处理器管理功能
处理器管理的硬件对象是处理器，其主要工作是处理中断事件和处理器调度。处理器管理具体包括如下内容。
- 进程控制和管理：包括进程创建、运行、阻塞、终止等。
- 进程同步和互斥。
- 进程通信和死锁。
- 线程控制和管理。
- 处理器调度：分作业调度、中程调度、低级调度等。

处理器管理策略的不同会形成不同类型的操作系统或不同类型的任务处理方式，如批处理、分时处理、实时处理等描述的是操作系统处理任务的不同策略。

### 存储管理功能
存储管理的硬件对象是内存储器，其功能包括存储分配、存储共享、地址转换与存储保护、存储扩充。

### 设备管理功能
设备管理的硬件对象是输入/输出设备，其功能包括设备分配、缓冲管理、设备驱动、设备独立性、实现虚拟设备。

### 文件管理功能
文件管理的对象是软件，其任务如下：提供文件逻辑组织方法、提供文件物理组织方法、提供文件的存取方法、提供文件的使用方法、实现文件的目录管理、实现文件的存取控制、实现文件的存储空间管理。

### 网络与通信管理功能
网络是对单机的扩展，其中包含多台互相连接的计算机，网络与通信管理对网络中的硬件和软件资源进行管理，其功能包括：网上资源管理功能；数据通信管理功能；网络管理功能，如故障管理、安全管理、性能管理、记账管理和配置管理。

## 操作系统的主要特性

### 并发性
并发性是指两个或两个以上的事件或活动在同一时间间隔内发生。

已经开始、尚未结束的两个或多个事件或活动是并发的。如果一个事件或活动开始前，另一个事件或活动已经结束，两者没有时间上的重叠，则这两个事件或活动是顺序的。并发的事件或活动在宏观上是同时进行的，在微观上可能是同时进行的，也可能是交替穿插进行的。

操作系统的并发性是指计算机系统中同时存在若干个运行着的程序（包括操作系统程序和用户程序），这些程序交替、穿插着执行。这些程序能够驱动不同的部件同时工作，如使多个I/O设备同时输入/输出，或者使设备I/O与CPU的计算同时进行，从而消除系统中部件和部件之间的相互等待，有效改善系统资源利用率，改进系统吞吐量，提高系统效率。

在计算机系统中，并发的实质是一个物理CPU（也可以是多个物理CPU）在若干道程序之间的多路复用。并发技术的关键在于如何对系统中多个运行程序（进程）进行切换。

与并发性概念相近的是并行性。并行性是指两个或两个以上的事件或活动在同一时刻发生。并行的事件或活动在宏观和微观上都是同时进行的。在多道程序环境下，并行性使多个程序同一时刻可在不同CPU上同时执行。并行的事件或活动一定是并发的，并发的事件或活动未必是并行的。

### 共享性
共享性是指操作系统中的资源（包括硬件资源和信息资源）可被多个并发执行的进程共同使用，而不是被其中某一个程序独占。

资源共享方式有两种：互斥访问和同时访问。

互斥访问也称顺序访问，系统中的某些资源同一时间内只允许一个进程访问。许多物理设备，如打印机、磁带机、卡片机等，以及某些数据和表格都是互斥共享的资源，称为临界资源。

临界资源：同一时间内只允许一个程序访问的资源。

临界资源的使用是顺序的，不是并发的，即不能交替、穿插使用。例如，打印机至少以文件为单位顺序使用，确保每个文件的内容连续打印在一起。

同时访问也称并发访问，允许同一时间内多个进程对某些资源进行交替、穿插地并发访问。也就是说，在微观上，某一进程对某一资源的访问不是连续的，各进程对该资源的访问是交错的，这种交错访问的顺序对访问的结果没有影响。典型的可供多个进程同时访问的资源是磁盘，可重入程序也可被同时访问。

磁盘与打印机的不同之处在于，磁盘上信息存放的物理顺序不是最终阅读的逻辑顺序，最终读取文件内容时，需要按照逻辑顺序重新装配文件信息块，装配正确的信息才是最终阅读的文件内容。磁盘上信息块的非连续存放不影响最终访问的正确结果。打印机则不然，打印机打印出的纸质信息是最终阅读的信息，必须与逻辑顺序一致。

并发性和共享性是操作系统两个最基本的特性，程序的并发执行导致资源共享，对共享资源的有效管理才能保证程序的并发执行。

### 异步性
异步性也称随机性，在多道程序环境中，程序的执行不是一贯到底，而是“走走停停”的，何时“走”何时“停”是不可预知的。但是，只要运行环境相同，操作系统必须保证多次运行同一进程时，都会获得与单道运行时相同的结果。异步性是并发性的表现特征，并发性是异步性的内在原因。

### 虚拟性
虚拟性是操作系统资源管理技术的特性，虚拟资源管理技术即资源虚化，将物理上的一个实体变成逻辑上的多个对应物，或把物理上的多个实体变成逻辑上的一个对应物。一些虚拟资源管理技术如下。
- 通过多道程序和分时使用CPU技术，物理上的一个CPU变成逻辑上的多个CPU。
- 通过Spooling（假脱机）技术把物理上的一台独占设备变成逻辑上的多台虚拟设备。
- 通过窗口技术可把物理上的一个屏幕变成逻辑上的多个虚拟屏幕。
- IBM的VM（虚拟计算机）技术把物理上的一台计算机变成逻辑上的多台计算机。
- 虚拟存储器把物理上的多个存储器（主存和外存）变成逻辑上的一个存储器，即虚拟存储器。

# 参考资料
操作系统原理与Linux实践教程

30天自制操作系统

现代操作系统（原书第3版）













