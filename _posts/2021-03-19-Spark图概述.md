---
layout: post
categories: [Spark]
description: none
keywords: Spark
---
# Spark图概述
Spark GraphX也是Spark生态圈中的一个核心组件。GraphX通过构建在RDD之上的图计算抽象层，更适合于高效地处理大型图数据。

## GraphX分布式图计算引擎
GraphX中所描述的图是带有循环的有限多重图，并通过图，更准确地说是前面所讨论的属性图进行扩展。接下来我们将会看到在GraphX内部图是如何构建的。

作为例子，我们推荐在本机启动spark-shell进行实验，它已经提供了GraphX相关的依赖。为了测试你的启动环境是否可以工作，你可以尝试使用Scala的通配符规则来加载完整的GraphX核心模块，例如：
```scala
import org.apache.spark.graphx._
```

## GraphX中图的表示
属性图是一个包含循环的有向多重图，其中顶点和边含有自定义的数据对象。GraphX中的核心入口是Graph API，它有如下的签名形式：
```scala
class Graph[VD, ED] {
  // 定义一些方法和属性
}

```
可以看到，在GraphX内部，图是由一个表示顶点的RDD和表示边的RDD组成的。这里，VD代表了属性图中顶点的数据类型，而ED则是边的数据类型。接下来，我们会详细地讨论VertexRDD和EdgeRDD，因为它们对于后面的内容至关重要。

在Spark GraphX中，每一个顶点含有一个Long型的唯一标识符，称作VertexId。实际上，VertexRDD[VD]不过是RDD[（VertexId，VD）]的扩展，在其上优化并添加了一组有用的功能而已，这些会在后面详细说到。因此简单地说，GraphX的顶点是含有标识符以及顶点数据的RDD，这与我们之前的猜测是一致的。

为了解释EdgeRDD的概念，我们首先来快速地看一下GraphX中边的实现形式。简单来说，GraphX中边的定义如下所示：
```scala

```
可以看到，边是由源顶点ID srcId、目标顶点ID dstId和数据类型为ED的属性对象attr组成的。与前面介绍的顶点RDD类似，我们可以将EdgeRDD[ED]理解为RDD[Edge[ED]]的扩展。因此在GraphX中边是由ED类型的边RDD构成的，这再次印证了到目前为止的讨论。

注：我们现在知道了在Spark 2.1中，GraphX中图的构成是一个顶点和边的RDD对。这是一个非常重要的信息，因为这至少在原理上允许我们使用Spark核心模块的所有方法来操作图数据。需要注意的一点是，许多图相关的方法针对图进行了相应的优化。当我们试图使用基本RDD所提供的方法去计算时，最好看看有没有对应的图计算方法，通常来说这会提供更好的性能。

举一个具体的例子，让我们使用前面所学到的知识从头构建一张图。假定环境中已有Spark Context（sc）可供使用。我们将利用前面小节图7-3所示的标号图来创建好友图。从上面了解到的GraphX知识可知，创建图结构需要指定顶点和边的数据类型，在这里我们将其表示为字符串类型。这样就可以使用parallelize来创建顶点RDD：


另一方面，图并行化是基于图的概念所进行的并行操作。例如，图并行的任务需要将每个顶点的所有入边的权重进行求和。为了执行这个任务，我们同时需要顶点和边的数据，这就涉及多个RDD。高效地执行这样的任务需要有一个合适的内部表示。为此，GraphX试图在两种不同的范式之间取得平衡，而在其他类似的项目中这是鲜有提供的。

