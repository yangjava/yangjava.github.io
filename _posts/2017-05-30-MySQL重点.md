---
layout: post
categories: [SQL]
description: none
keywords: SQL
---
# MySQL重点

## MYSQL单表存储量计算
以主键为bigint为例：
```
根节点存储量 = 16384(16KB)
一个数据项大小 = bigint主键(8byte) + 指针(6byte) = 14 byte
根节点存储数据项大小 = 16384 / 14 ≈ 1170

高度为3的B+树可以存放数据：1170 * 1170 * 16 = 21902400
```
所以在InnoDB中B+树高度一般为1-3层，它就能满足千万级的数据存储。在查找数据时一次页的查找代表一次IO，所以通过主键索引查询通常只需要1-3次IO操作即可查找到数据，一般mysql一张表的数据超过了千万也是得进行分表操作

## 执行计划explain
以下全部详细解析explain各个属性含义：
```
+----+-------------+-----------+------------+------+-----------------+------------+---------+-------+------+----------+-------+
| id | select_type | table     | partitions | type | possible_keys   | key        | key_len | ref   | rows | filtered | Extra |
+----+-------------+-----------+------------+------+-----------------+------------+---------+-------+------+----------+-------+
```
各属性含义：

id: 查询的序列号

select_type: 查询的类型，主要是区别普通查询和联合查询、子查询之类的复杂查询

SIMPLE：查询中不包含子查询或者UNION
查询中若包含任何复杂的子部分，最外层查询则被标记为：PRIMARY
在SELECT或WHERE列表中包含了子查询，该子查询被标记为：SUBQUERY
table: 输出的行所引用的表

type: 访问类型

ALL: 扫描全表
index: 扫描全部索引树
range: 扫描部分索引，索引范围扫描，对索引的扫描开始于某一点，返回匹配值域的行，常见于between、等的查询
ref: 使用非唯一索引或非唯一索引前缀进行的查找
（eq_ref和const的区别：）
eq_ref：唯一性索引扫描，对于每个索引键，表中只有一条记录与之匹配。常见于主键或唯一索引扫描
const, system: 单表中最多有一个匹配行，查询起来非常迅速，例如根据主键或唯一索引查询。system是const类型的特例，当查询- 的表只有一行的情况下， 使用system。
NULL: 不用访问表或者索引，直接就能得到结果，如select 1 from test where 1
key: 显示MySQL实际决定使用的索引。如果没有索引被选择，是NULL

key_len: 使用到索引字段的长度
注：key_len显示的值为索引字段的最大可能长度，并非实际使用长度，即key_len是根据表定义计算而得，不是通过表内检索出的。

ref: 显示哪个字段或常数与key一起被使用

rows: 这个数表示mysql要遍历多少数据才能找到，表示MySQL根据表统计信息及索引选用情况，估算的找到所需的记录所需要读取的行数，在innodb上可能是不准确的

Extra: 执行情况的说明和描述。包含不适合在其他列中显示但十分重要的额外信息。

Using index：表示使用索引，如果只有 Using index，说明他没有查询到数据表，只用索引表就完成了这个查询，这个叫覆盖索引。

Using where：表示条件查询，如果不读取表的所有数据，或不是仅仅通过索引就可以获取所有需要的数据，则会出现 Using where


